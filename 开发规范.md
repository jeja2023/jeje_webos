# JeJe WebOS å¼€å‘æ‰‹å†Œ

> ğŸ“˜ **å¼€å‘è§„èŒƒä¸æ¨¡å—å®æˆ˜åˆé›†**
> 
> æœ¬æ–‡æ¡£èåˆäº†ç³»ç»Ÿå¼€å‘è§„èŒƒä¸æ¨¡å—å¼€å‘æŒ‡å—ï¼Œæ—¢æ˜¯æ¶æ„çº¦æŸçš„"æ³•å¾‹æ³•è§„"ï¼Œä¹Ÿæ˜¯ä¸šåŠ¡å¼€å‘çš„"æ“ä½œæ‰‹å†Œ"ã€‚

---

## ğŸ“‘ ç›®å½•

1. **[æ ¸å¿ƒæ¶æ„è§„èŒƒ](#ä¸€-æ ¸å¿ƒæ¶æ„è§„èŒƒ)** (Design Principles)
2. **[é¡¹ç›®ç›®å½•ç»“æ„](#äºŒ-é¡¹ç›®ç›®å½•ç»“æ„)** (Directory Structure)
3. **[é€šç”¨å¼€å‘æ ‡å‡†](#ä¸‰-é€šç”¨å¼€å‘æ ‡å‡†)** (Naming & API Standards)
4. **[æ¨¡å—å¼€å‘å®æˆ˜](#å››-æ¨¡å—å¼€å‘å®æˆ˜-module-development)** (Build Your App)
5. **[å‰ç«¯å¼€å‘æŒ‡å—](#äº”-å‰ç«¯å¼€å‘æŒ‡å—)** (Frontend Development)
6. **[ä¸‰å¤§æˆ’å¾‹](#å…­-ä¸‰å¤§æˆ’å¾‹-donts)** (Critical Rules)

---

## ä¸€ã€æ ¸å¿ƒæ¶æ„è§„èŒƒ

JeJe WebOS é‡‡ç”¨ **å¾®å†…æ ¸ (Micro-Kernel)** æ¶æ„ï¼Œä¸¥æ ¼éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

### 1.1 æ¶æ„åˆ†å±‚
ç³»ç»Ÿä¸¥æ ¼åˆ’åˆ†ä¸º **å†…æ ¸å±‚ (Kernel)** ä¸ **åº”ç”¨å±‚ (Modules)**ã€‚

```mermaid
graph TD
    A[åº”ç”¨å±‚ Modules] -->|ä¾èµ–| B(å†…æ ¸å±‚ Kernel)
    B -->|åŠ è½½| A
    subgraph Core[å†…æ ¸åŸºç¡€è®¾æ–½]
        Loader[åŠ è½½å™¨]
        EventBus[äº‹ä»¶æ€»çº¿]
        Security[å®‰å…¨è®¤è¯]
        Database[æ•°æ®åº“è¿æ¥]
    end
    subgraph Apps[ä¸šåŠ¡æ¨¡å—]
        Blog[åšå®¢]
        Notes[ç¬”è®°]
        Feedback[åé¦ˆ]
    end
```

### 1.2 æ ¸å¿ƒèŒè´£

| ç»„ä»¶ | èŒè´£ | ğŸ”´ ç¦åŒº |
| :--- | :--- | :--- |
| **å†…æ ¸ (Core)** | æä¾›è´¦å·ã€é‰´æƒã€æ•°æ®åº“è¿æ¥ã€äº‹ä»¶æ€»çº¿ç­‰åŸºç¡€è®¾æ–½ | **ä¸¥ç¦åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘** (å¦‚æ–‡ç« ã€è®¢å•) |
| **æ¨¡å— (Modules)** | å®ç°å…·ä½“ä¸šåŠ¡åŠŸèƒ½ (Blog, Notes) | **ä¸¥ç¦ç›´æ¥ import å…¶ä»–æ¨¡å—ä»£ç ** |

---

## äºŒã€é¡¹ç›®ç›®å½•ç»“æ„

### 2.1 æ•´ä½“ç»“æ„

```text
jeje_webos/
â”œâ”€â”€ backend/                      # ğŸ åç«¯ (FastAPI)
â”‚   â”œâ”€â”€ core/                     # --- å†…æ ¸å±‚ (ç¦æ­¢ä¿®æ”¹) ---
â”‚   â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py           # DB è¿æ¥ä¸ Session
â”‚   â”‚   â”œâ”€â”€ loader.py             # æ¨¡å—åŠ è½½å™¨
â”‚   â”‚   â””â”€â”€ security.py           # JWT ä¸ æƒé™æ ¡éªŒ
â”‚   â”œâ”€â”€ modules/                  # --- åº”ç”¨å±‚ (å¼€å‘ä¸»æˆ˜åœº) ---
â”‚   â”‚   â”œâ”€â”€ _template/            # æ¨¡å—ç”Ÿæˆæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ blog/                 # [ç¤ºä¾‹] åšå®¢æ¨¡å—
â”‚   â”‚   â””â”€â”€ notes/                # [ç¤ºä¾‹] ç¬”è®°æ¨¡å—
â”‚   â”œâ”€â”€ routers/                  # ç³»ç»Ÿçº§è·¯ç”± (Auth, System)
â”‚   â”œâ”€â”€ models/                   # ç³»ç»Ÿçº§æ¨¡å‹ (User, Role)
â”‚   â””â”€â”€ main.py                   # å¯åŠ¨å…¥å£
â”‚
â”œâ”€â”€ frontend/                     # ğŸ¨ å‰ç«¯ (Vanilla JS)
â”‚   â”œâ”€â”€ js/                       # --- é€»è¾‘å±‚ ---
â”‚   â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒåº“ (Router, Store, Api)
â”‚   â”‚   â”œâ”€â”€ components/           # UI ç»„ä»¶ (Window, Dock)
â”‚   â”‚   â””â”€â”€ pages/                # é¡µé¢ç»„ä»¶
â”‚   â””â”€â”€ css/                      # --- æ ·å¼å±‚ ---
```

### 2.2 æ¨¡å—å†…éƒ¨ç»“æ„ (`backend/modules/xxx/`)

æ¯ä¸ªä¸šåŠ¡æ¨¡å—å¿…é¡»éµå¾ªä»¥ä¸‹å‘½åè§„èŒƒï¼ˆå¼ºåˆ¶å¸¦æœ‰æ¨¡å—å‰ç¼€ï¼‰ï¼Œä»¥ä¾¿äºåœ¨ IDE ä¸­å¿«é€ŸåŒºåˆ†ï¼š

| æ–‡ä»¶å | å¿…é¡» | è¯´æ˜ |
| :--- | :---: | :--- |
| `__init__.py` | âœ… | ç©ºæ–‡ä»¶ï¼Œæ ‡è®°ä¸º Python åŒ… |
| `{id}_manifest.py` | âœ… | **æ¨¡å—èº«ä»½è¯**ï¼Œå®šä¹‰åç§°ã€å›¾æ ‡ã€æƒé™ã€èœå•ã€ç”Ÿå‘½å‘¨æœŸé’©å­ |
| `{id}_router.py` | âœ… | API è·¯ç”±å®šä¹‰ |
| `{id}_models.py` | âœ… | æ•°æ®åº“è¡¨ç»“æ„ (SQLAlchemy) |
| `{id}_schemas.py` | âœ… | æ•°æ®éªŒè¯æ¨¡å‹ (Pydantic) |
| `{id}_services.py` | âšª | ä¸šåŠ¡é€»è¾‘å±‚ (æ¨è)ï¼Œå¤æ‚æ¨¡å—å¯æŒ‰åŠŸèƒ½æ‹†åˆ†å¤šä¸ª service æ–‡ä»¶ |
| `tests/` | âšª | æ¨¡å—æµ‹è¯•ç›®å½•ï¼ˆæ¨èï¼‰ï¼ŒåŒ…å« `__init__.py` å’Œ `test_{id}.py` |

> â„¹ï¸ **è¯´æ˜**ï¼šä¸ºäº†é˜²æ­¢åœ¨ IDEï¼ˆå¦‚ VS Codeï¼‰ä¸­æœç´¢æ–‡ä»¶æ—¶å‡ºç°å¤§é‡åŒåæ–‡ä»¶ï¼ˆå¦‚ `router.py`ï¼‰ï¼Œæ‰€æœ‰æ¨¡å—æ–‡ä»¶å¿…é¡»å¸¦æœ‰ `{module_id}_` å‰ç¼€ã€‚

---

## ä¸‰ã€é€šç”¨å¼€å‘æ ‡å‡†

### 3.1 å‘½åè§„èŒƒ

| å¯¹è±¡ | è§„èŒƒ | ç¤ºä¾‹ |
| :--- | :--- | :--- |
| **æ–‡ä»¶å** | `{module_id}_` å‰ç¼€ | `blog_router.py` |
| **ç±»å** | PascalCase | `BlogPost`, `BlogService` |
| **å˜é‡/å‡½æ•°** | snake_case | `get_post_list`, `user_id` |
| **æ•°æ®åº“è¡¨** | `{module_id}_` å‰ç¼€ | `blog_posts`, `sys_users` |
| **API è·¯å¾„** | `/api/v1/{module}/{resource}` | `/api/v1/blog/posts` |

### 3.2 ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰ API å¿…é¡»è¿”å›ç»Ÿä¸€çš„ JSON ç»“æ„ï¼š

```json
// æˆåŠŸ
{ "code": 200, "message": "æ“ä½œæˆåŠŸ", "data": { ... } }

// å¤±è´¥
{ "code": 400, "message": "å‚æ•°é”™è¯¯", "data": null }

// åˆ†é¡µ
{ 
    "code": 200, 
    "message": "success", 
    "data": { "items": [...], "total": 100, "page": 1, "size": 10 } 
}
```

### 3.3 æ•°æ®åº“æ¨¡å‹è§„èŒƒ (SQLAlchemy)

åœ¨ä½¿ç”¨ SQLAlchemy å®šä¹‰æ•°æ®æ¨¡å‹æ—¶ï¼Œå¿…é¡»éµå®ˆä»¥ä¸‹è§„åˆ™ä»¥é¿å… ORM æ˜ å°„é”™è¯¯å’Œçƒ­é‡è½½å†²çªï¼š

1.  **ä¸¥ç¦ä½¿ç”¨å­—ç¬¦ä¸²å¼•ç”¨**ï¼š
    - åœ¨å®šä¹‰ `ForeignKey` å’Œ `relationship` æ—¶ï¼Œ**å¿…é¡»ä½¿ç”¨æ¨¡å‹ç±»æœ¬èº«**ï¼ˆå¦‚ `ForeignKey(User.id)`ï¼‰ï¼Œä¸¥ç¦ä½¿ç”¨å­—ç¬¦ä¸²ï¼ˆå¦‚ `"sys_users.id"` æˆ– `"User"`ï¼‰ã€‚
    - å­—ç¬¦ä¸²å¼•ç”¨åœ¨æ¨¡å—çƒ­é‡è½½æˆ–åŠ¨æ€åŠ è½½æ—¶ï¼Œä¼šå¯¼è‡´ "Multiple classes found" æˆ– "UnmappedColumnError" ç­‰éš¾ä»¥æ’æŸ¥çš„é”™è¯¯ã€‚

2.  **è·¨æ¨¡å—å…³ç³»å¤„ç†**ï¼š
    - é¿å…åœ¨ä¸åŒæ¨¡å—çš„æ¨¡å‹ä¹‹é—´å®šä¹‰åŒå‘ `relationship`ã€‚
    - å¦‚æœä¸¤ä¸ªæ¨¡å—ï¼ˆå¦‚ `transfer` å’Œ `account`ï¼‰ç›¸äº’ä¾èµ–ï¼Œä¸è¦ä½¿ç”¨ ORM çš„ `relationship` è¿›è¡Œå…³è”ï¼Œè€Œæ˜¯ä»…ä¿ç•™ `ForeignKey` å­—æ®µã€‚
    - åœ¨ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServiceï¼‰é€šè¿‡ ID å•ç‹¬æŸ¥è¯¢å…³è”æ•°æ®ã€‚è¿™ä¹Ÿæ˜¯å¾®æœåŠ¡æ¶æ„çš„æœ€ä½³å®è·µã€‚

3.  **é¿å…ä½¿ç”¨ SQLAlchemy Enum ç±»å‹**ï¼š
    - å®šä¹‰æ•°æ®åº“åˆ—æ—¶ï¼Œ**å°½é‡ä½¿ç”¨ `String` ç±»å‹ä»£æ›¿ `Enum` ç±»å‹**ã€‚
    - åœ¨ Python ä»£ç ä¸­å¯ä»¥å®šä¹‰ `Enum` ç±»ï¼ˆå»ºè®®ç»§æ‰¿ `str`, å¦‚ `class Status(str, Enum)`) ç”¨äºä¸šåŠ¡é€»è¾‘åˆ¤æ–­ã€‚
    - åœ¨ `Column` å®šä¹‰ä¸­ï¼Œä½¿ç”¨ `String` å­˜å‚¨æšä¸¾å€¼ï¼ˆä¾‹å¦‚ `Column(String(32), default=Status.PENDING.value)`ï¼‰ã€‚
    - åŸå› ï¼šSQLAlchemy çš„ Enum ç±»å‹åœ¨ä¸åŒæ•°æ®åº“ï¼ˆMySQL vs SQLiteï¼‰ä¸‹è¡Œä¸ºä¸ä¸€è‡´ï¼Œä¸”åœ¨çƒ­é‡è½½åœºæ™¯ä¸‹ï¼ˆPython ç±»é‡æ–°å®šä¹‰ï¼‰ä¼šå¯¼è‡´ç±»å‹æ ¡éªŒå¤±è´¥ï¼ˆLookupErrorï¼‰ã€‚

4.  **é¿å…è¿‡åº¦é…ç½®**ï¼š
    - ä¸è¦æ‰‹åŠ¨æŒ‡å®š `primaryjoin` æˆ– `foreign_keys`ï¼Œé™¤éè¿™æ˜¯è§£å†³å†²çªçš„æœ€åæ‰‹æ®µã€‚SQLAlchemy çš„è‡ªåŠ¨æ¨æ–­é€šå¸¸æ¯”æ‰‹åŠ¨é…ç½®æ›´å¯é ã€‚

5.  **ç»Ÿä¸€å¯¼å…¥è·¯å¾„**ï¼š
    - æ‰€æœ‰æ¨¡å—å¯¼å…¥å¿…é¡»åŸºäºé¡¹ç›®æ ¹ç›®å½•ï¼ˆ`backend`ï¼‰ã€‚
    - ä¾‹å¦‚ï¼š`from modules.transfer.models import TransferSession`ï¼Œä¸è¦ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ `..models`ï¼Œè¿™ä¼šå¯¼è‡´åŒä¸€ä¸ªæ¨¡å—è¢«åŠ è½½ä¸¤æ¬¡ï¼ˆsys.modules ä¸­å­˜åœ¨ä¸¤ä»½ï¼‰ï¼Œå¼•å‘ ORM æ³¨å†Œå†²çªã€‚

---

## å››ã€æ¨¡å—å¼€å‘å®æˆ˜ (Module Development)

æœ¬èŠ‚æŒ‡å¯¼ä½ å¦‚ä½•ä»é›¶åˆ›å»ºä¸€ä¸ªæ–°æ¨¡å—ï¼ˆå¦‚ "å¾…åŠäº‹é¡¹" `todo`ï¼‰ã€‚

### ğŸš€ æ–¹å¼ä¸€ï¼šä½¿ç”¨ CLI è„šæ‰‹æ¶ (æ¨è)

**3ç§’é’Ÿç”Ÿæˆå®Œæ•´æ¨¡å—ï¼š**

```bash
cd backend
python scripts/create_module.py todo å¾…åŠäº‹é¡¹
```

æ­¤å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆåç«¯ä»£ç  (`backend/modules/todo/`) å’Œå‰ç«¯ä»£ç  (`frontend/js/pages/todo.js`)ã€‚é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆã€‚

### ğŸ› ï¸ æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¼€å‘æµç¨‹

#### 1. å®šä¹‰æ¸…å• (`manifest.py`)
è¿™æ˜¯æ¨¡å—çš„å…¥å£ï¼Œç³»ç»Ÿæ ¹æ®æ­¤æ–‡ä»¶åŠ è½½æ¨¡å—ã€‚

```python
from core.loader import ModuleManifest, ModuleAssets
import logging

logger = logging.getLogger(__name__)

# ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆå¯é€‰ï¼‰
async def on_install():
    """æ¨¡å—å®‰è£…æ—¶æ‰§è¡Œï¼ˆå¦‚åˆå§‹åŒ–æ•°æ®ï¼‰"""
    logger.info("æ¨¡å—æ­£åœ¨å®‰è£…...")

async def on_enable():
    """æ¨¡å—å¯ç”¨æ—¶æ‰§è¡Œ"""
    logger.info("æ¨¡å—å·²å¯ç”¨")

async def on_disable():
    """æ¨¡å—ç¦ç”¨æ—¶æ‰§è¡Œ"""
    logger.info("æ¨¡å—å·²ç¦ç”¨")

manifest = ModuleManifest(
    # åŸºæœ¬ä¿¡æ¯
    id="todo",
    name="å¾…åŠäº‹é¡¹",
    version="1.0.0",
    description="ç®€å•é«˜æ•ˆçš„å¾…åŠäº‹é¡¹ç®¡ç†",
    icon="âœ…",
    author="JeJe WebOS",
    
    # è·¯ç”±é…ç½®ï¼šè‡ªåŠ¨æŒ‚è½½åˆ° /api/v1/todo
    router_prefix="/api/v1/todo",
    
    # èœå•é…ç½®ï¼šè‡ªåŠ¨æ³¨å†Œåˆ°å‰ç«¯ä¾§è¾¹æ 
    menu={
        "title": "å¾…åŠ",
        "icon": "âœ…",
        "path": "/todo",
        "order": 10,  # èœå•æ’åºæƒé‡
        "children": [
            {"title": "æˆ‘çš„å¾…åŠ", "path": "/todo/list", "icon": "ğŸ“"},
            {"title": "æ–°å»ºä»»åŠ¡", "path": "/todo/add", "icon": "â•"}
        ]
    },
    
    # å‰ç«¯èµ„æºï¼ˆç•™ç©ºåˆ™è‡ªåŠ¨å‘ç° static/ ç›®å½•ï¼‰
    assets=ModuleAssets(css=[], js=[]),
    
    # æƒé™å£°æ˜
    permissions=["todo.read", "todo.create", "todo.update", "todo.delete"],
    
    # æ¨¡å—ä¾èµ–ï¼ˆå…¶ä»–æ¨¡å—IDåˆ—è¡¨ï¼‰
    dependencies=[],
    
    # å†…æ ¸ç‰ˆæœ¬è¦æ±‚
    kernel_version=">=1.0.0",
    
    # æ˜¯å¦å¯ç”¨
    enabled=True,
    
    # ç”Ÿå‘½å‘¨æœŸé’©å­ç»‘å®š
    on_install=on_install,
    on_enable=on_enable,
    on_disable=on_disable,
)
```

#### 2. å®šä¹‰æ•°æ®æ¨¡å‹ (`models.py`)

```python
from core.database import Base
from sqlalchemy.orm import Mapped, mapped_column
from sqlalchemy import Integer, String

class TodoItem(Base):
    # âš ï¸ å¿…é¡»å¸¦æ¨¡å—å‰ç¼€ todo_
    __tablename__ = "todo_items"
    
    id: Mapped[int] = mapped_column(Integer, primary_key=True)
    title: Mapped[str] = mapped_column(String(100))
```

#### 3. ç¼–å†™ API (`router.py`)

```python
from fastapi import APIRouter, Depends
from core.database import get_db
from schemas import success  # ç»Ÿä¸€å“åº”å°è£…

router = APIRouter()

@router.get("/list")
async def get_list(db = Depends(get_db)):
    # ... ä¸šåŠ¡é€»è¾‘
    return success(data)
```

---

### 4.3 æ¨¡å—æ‰“åŒ…ä¸å‘å¸ƒ

å½“æ¨¡å—å¼€å‘å®Œæˆåï¼Œä½ å¯ä»¥å°†å…¶æ‰“åŒ…ä¸º `.jwapp` æ–‡ä»¶ï¼Œä»¥ä¾¿åˆ†å‘æˆ–é€šè¿‡åº”ç”¨å¸‚åœºç¦»çº¿å®‰è£…ã€‚

#### 1. ä½¿ç”¨æ‰“åŒ…è„šæœ¬ (æ¨è)

æˆ‘ä»¬æä¾›äº†å¿«æ·çš„æ‰“åŒ…å·¥å…·ï¼š

```bash
cd backend
# æ ¼å¼: python scripts/pack_module.py <module_id>
python scripts/pack_module.py todo
```

å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `dist/` æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ `todo.jwapp` æ–‡ä»¶ã€‚

#### 2. æ‰‹åŠ¨æ‰“åŒ… (Manual)

`.jwapp` æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ZIP å‹ç¼©åŒ…ï¼Œä½†å¿…é¡»éµå¾ªç‰¹å®šçš„ç›®å½•ç»“æ„ï¼š

```text
todo.jwapp (ZIP Archive)
â””â”€â”€ todo/                   # å¿…é¡»åŒ…å«ä¸€å±‚ä»¥æ¨¡å—IDå‘½åçš„æ ¹æ–‡ä»¶å¤¹
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ todo_manifest.py
    â”œâ”€â”€ todo_router.py
    â””â”€â”€ ...
```

> âš ï¸ **æ³¨æ„**ï¼šå‹ç¼©åŒ…å†…**å¿…é¡»**åŒ…å«é¡¶å±‚çš„æ–‡ä»¶å¤¹ï¼ˆå¦‚ `todo/`ï¼‰ï¼Œä¸èƒ½ç›´æ¥å°†æ–‡ä»¶æ”¾åœ¨å‹ç¼©åŒ…æ ¹ç›®å½•ï¼Œå¦åˆ™ä¼šå¯¼è‡´å®‰è£…å¤±è´¥æˆ–æ–‡ä»¶å†²çªã€‚

---

### 4.4 æ¨¡å—æµ‹è¯•è§„èŒƒ

ä¸ºä¿è¯æ¨¡å—è´¨é‡ï¼Œå»ºè®®ä¸ºæ¯ä¸ªæ¨¡å—ç¼–å†™å•å…ƒæµ‹è¯•ã€‚æµ‹è¯•æ–‡ä»¶åº”æ”¾åœ¨æ¨¡å—å†…éƒ¨çš„ `tests/` ç›®å½•ä¸‹ï¼Œè¿™æ ·å½“æ¨¡å—è¢«åˆ é™¤æ—¶ï¼Œæµ‹è¯•æ–‡ä»¶ä¹Ÿä¼šä¸€å¹¶æ¸…ç†ã€‚

#### 1. ç›®å½•ç»“æ„

```text
modules/todo/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ todo_manifest.py
â”œâ”€â”€ todo_router.py
â”œâ”€â”€ todo_services.py
â””â”€â”€ tests/                  # æµ‹è¯•ç›®å½•
    â”œâ”€â”€ __init__.py         # å¿…é¡»
    â””â”€â”€ test_todo.py        # æµ‹è¯•æ–‡ä»¶
```

#### 2. æµ‹è¯•ç¤ºä¾‹

```python
# modules/todo/tests/test_todo.py
import pytest
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))))

from modules.todo.todo_services import TodoService

class TestTodoService:
    def test_create_todo(self):
        """æµ‹è¯•åˆ›å»ºå¾…åŠ"""
        # ... æµ‹è¯•é€»è¾‘
        pass
```

#### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå•ä¸ªæ¨¡å—çš„æµ‹è¯•
python -m pytest modules/todo/tests/ -v

# è¿è¡Œæ‰€æœ‰æ¨¡å—æµ‹è¯•
python -m pytest modules/*/tests/ -v

# è¿è¡Œæ ¸å¿ƒæµ‹è¯• + æ¨¡å—æµ‹è¯•
python -m pytest tests/ modules/*/tests/ -v
```

---

## äº”ã€å‰ç«¯å¼€å‘æŒ‡å—

JeJe WebOS å‰ç«¯é‡‡ç”¨ **Vanilla JS Component** æ¨¡å¼ï¼Œæ— éœ€æ„å»ºå·¥å…·ã€‚

### 5.1 é¡µé¢ç»„ä»¶å¼€å‘

åœ¨ `frontend/js/pages/` ä¸­åˆ›å»º `todo.js`ï¼š

```javascript
// å¿…é¡»ç»§æ‰¿ Component åŸºç±»
class TodoPage extends Component {
    constructor(container) {
        super(container);
        // å®šä¹‰å“åº”å¼çŠ¶æ€
        this.state = {
            list: [],
            loading: false
        };
    }

    // æ¸²æŸ“ HTML (ç±»ä¼¼ React render)
    render() {
        const { list } = this.state;
        return `
            <div class="page-todo">
                <h1>å¾…åŠäº‹é¡¹</h1>
                <ul>
                    ${list.map(item => `<li>${item.title}</li>`).join('')}
                </ul>
            </div>
        `;
    }

    // ç”Ÿå‘½å‘¨æœŸï¼šæŒ‚è½½åæ‰§è¡Œ
    async afterMount() {
        // è°ƒç”¨åç«¯ API (core/api.js æä¾›çš„å°è£…)
        const res = await Api.get('/todo/list');
        // æ›´æ–°çŠ¶æ€ï¼Œè‡ªåŠ¨è§¦å‘ render
        this.setState({ list: res.data.items });
    }
}
```

### 5.2 æ³¨å†Œè·¯ç”±

åœ¨ `app.js` ä¸­æ³¨å†Œä½ çš„é¡µé¢ï¼š

```javascript
'/todo/list': { 
    auth: true, 
    handler: wrap(TodoPage, 'å¾…åŠäº‹é¡¹') 
}
```

### 5.3 JS/CSS æ–‡ä»¶å‘½åä¸å­˜æ”¾è§„èŒƒ

#### 5.3.1 æ–‡ä»¶å‘½åè§„åˆ™

**æ ¸å¿ƒåŸåˆ™ï¼šJS å’Œ CSS æ–‡ä»¶å¿…é¡»ä¸€ä¸€å¯¹åº”ï¼Œä¸”æ–‡ä»¶åä¿æŒä¸€è‡´ã€‚**

| æ–‡ä»¶ç±»å‹ | å‘½åè§„åˆ™ | ç¤ºä¾‹ |
|---------|---------|------|
| **é¡µé¢ JS** | `{module_id}.js` æˆ– `{module_id}_{page_name}.js` | `todo.js`, `analysis_chart.js` |
| **é¡µé¢ CSS** | **å¿…é¡»ä¸ JS æ–‡ä»¶åå®Œå…¨ä¸€è‡´** | `todo.css`, `analysis_chart.css` |
| **ç»„ä»¶ JS** | `{component_name}.js` | `window.js`, `dock.js` |
| **ç»„ä»¶ CSS** | **å¿…é¡»ä¸ JS æ–‡ä»¶åå®Œå…¨ä¸€è‡´** | `window.css`, `dock.css` |

**è§„åˆ™è¯´æ˜ï¼š**
- âœ… **æ­£ç¡®**ï¼š`analysis_smart_report.js` å¯¹åº” `analysis_smart_report.css`
- âŒ **é”™è¯¯**ï¼š`analysis_smart_report.js` å¯¹åº” `smart_report.css`ï¼ˆæ–‡ä»¶åä¸ä¸€è‡´ï¼‰
- âŒ **é”™è¯¯**ï¼š`todo.js` å¯¹åº” `todo_page.css`ï¼ˆæ–‡ä»¶åä¸ä¸€è‡´ï¼‰

#### 5.3.2 æ–‡ä»¶å­˜æ”¾è§„åˆ™

**ç›®å½•ç»“æ„å¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„èŒƒï¼š**

```text
frontend/
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåº“ï¼ˆç³»ç»Ÿçº§ï¼‰
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â”œâ”€â”€ router.js
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/             # UI ç»„ä»¶ï¼ˆå¯å¤ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ window.js           # çª—å£ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ dock.js             # Dock æ 
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ pages/                  # é¡µé¢ç»„ä»¶ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚       â”œâ”€â”€ todo.js             # ç®€å•é¡µé¢
â”‚       â”œâ”€â”€ analysis/           # å¤æ‚æ¨¡å—ï¼ˆå­ç›®å½•ï¼‰
â”‚       â”‚   â”œâ”€â”€ analysis.js
â”‚       â”‚   â”œâ”€â”€ analysis_chart.js
â”‚       â”‚   â””â”€â”€ analysis_smart_report.js
â”‚       â””â”€â”€ datalens/           # å¤šæ–‡ä»¶æ¨¡å—
â”‚           â”œâ”€â”€ datalens.js
â”‚           â”œâ”€â”€ datalens_hub.js
â”‚           â””â”€â”€ datalens_viewer.js
â”‚
â””â”€â”€ css/
    â”œâ”€â”€ core/                   # æ ¸å¿ƒæ ·å¼ï¼ˆç³»ç»Ÿçº§ï¼‰
    â”‚   â”œâ”€â”€ variables.css       # CSS å˜é‡
    â”‚   â”œâ”€â”€ reset.css           # é‡ç½®æ ·å¼
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ components/             # ç»„ä»¶æ ·å¼ï¼ˆä¸ js/components/ å¯¹åº”ï¼‰
    â”‚   â”œâ”€â”€ window.css
    â”‚   â”œâ”€â”€ dock.css
    â”‚   â””â”€â”€ ...
    â””â”€â”€ pages/                  # é¡µé¢æ ·å¼ï¼ˆä¸ js/pages/ å¯¹åº”ï¼‰
        â”œâ”€â”€ todo.css
        â”œâ”€â”€ analysis/
        â”‚   â”œâ”€â”€ analysis.css
        â”‚   â”œâ”€â”€ analysis_chart.css
        â”‚   â””â”€â”€ analysis_smart_report.css
        â””â”€â”€ datalens/
            â”œâ”€â”€ datalens.css
            â”œâ”€â”€ datalens_hub.css
            â””â”€â”€ datalens_viewer.css
```

**å­˜æ”¾è§„åˆ™ï¼š**
1. **ç›®å½•å¯¹åº”**ï¼š`js/pages/` ä¸­çš„æ–‡ä»¶å¿…é¡»åœ¨ `css/pages/` ä¸­æœ‰å¯¹åº”çš„ CSS æ–‡ä»¶
2. **å­ç›®å½•ä¸€è‡´**ï¼šå¦‚æœ JS æ–‡ä»¶åœ¨å­ç›®å½•ä¸­ï¼ˆå¦‚ `js/pages/analysis/`ï¼‰ï¼ŒCSS æ–‡ä»¶ä¹Ÿå¿…é¡»åœ¨ç›¸åŒçš„å­ç›®å½•ä¸­ï¼ˆ`css/pages/analysis/`ï¼‰
3. **æ–‡ä»¶åä¸€è‡´**ï¼šCSS æ–‡ä»¶åå¿…é¡»ä¸å¯¹åº”çš„ JS æ–‡ä»¶åå®Œå…¨ä¸€è‡´ï¼ˆåŒ…æ‹¬æ‰©å±•åå‰çš„éƒ¨åˆ†ï¼‰

**ç¤ºä¾‹ï¼š**
- âœ… `js/pages/analysis/analysis_chart.js` â†’ `css/pages/analysis/analysis_chart.css`
- âœ… `js/pages/datalens/datalens_viewer.js` â†’ `css/pages/datalens/datalens_viewer.css`
- âŒ `js/pages/analysis/analysis_chart.js` â†’ `css/pages/analysis_chart.css`ï¼ˆç¼ºå°‘å­ç›®å½•ï¼‰
- âŒ `js/pages/todo.js` â†’ `css/pages/todo_page.css`ï¼ˆæ–‡ä»¶åä¸ä¸€è‡´ï¼‰

#### 5.3.3 æ–‡ä»¶å¼•ç”¨è§„èŒƒ

åœ¨ HTML æˆ– JS ä¸­å¼•ç”¨ CSS æ–‡ä»¶æ—¶ï¼Œè·¯å¾„å¿…é¡»ä¸ JS æ–‡ä»¶è·¯å¾„ä¿æŒä¸€è‡´ï¼š

```javascript
// åœ¨ analysis_chart.js ä¸­å¼•ç”¨æ ·å¼
// âœ… æ­£ç¡®ï¼šè·¯å¾„ä¸ JS æ–‡ä»¶è·¯å¾„å¯¹åº”
const cssPath = '/css/pages/analysis/analysis_chart.css';

// âŒ é”™è¯¯ï¼šè·¯å¾„ä¸ä¸€è‡´
const cssPath = '/css/pages/analysis_chart.css';
```

---

## å…­ã€å­˜å‚¨è§„èŒƒ (Storage Standards)

JeJe WebOS é‡‡ç”¨ç»Ÿä¸€çš„å­˜å‚¨ç®¡ç†å™¨ (`StorageManager`) ç®¡ç†æ‰€æœ‰æ–‡ä»¶å­˜å‚¨ï¼Œç¡®ä¿æ–‡ä»¶æŒ‰ç”¨æˆ·éš”ç¦»ã€æŒ‰æ¨¡å—åˆ†ç±»ï¼Œä¾¿äºæƒé™æ§åˆ¶å’Œæ•°æ®æ¸…ç†ã€‚

### 6.1 å­˜å‚¨ç›®å½•ç»“æ„

**å…¨å±€å­˜å‚¨ç›®å½•ç»“æ„ï¼š**

```text
storage/
â”œâ”€â”€ public/                      # å…¬å…±æ–‡ä»¶ï¼ˆä¸åŒºåˆ†ç”¨æˆ·ï¼‰
â”‚   â”œâ”€â”€ avatars/                # ç”¨æˆ·å¤´åƒ
â”‚   â””â”€â”€ attachments/            # å…¬å…±é™„ä»¶
â”‚
â”œâ”€â”€ users/                      # ç”¨æˆ·ç§æœ‰æ–‡ä»¶ï¼ˆæŒ‰ç”¨æˆ·IDéš”ç¦»ï¼‰
â”‚   â””â”€â”€ user_{id}/              # å•ä¸ªç”¨æˆ·çš„æ‰€æœ‰ç§æœ‰æ–‡ä»¶
â”‚       â”œâ”€â”€ uploads/            # ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶
â”‚       â””â”€â”€ exports/            # ç”¨æˆ·å¯¼å‡ºçš„æ–‡ä»¶
â”‚
â”œâ”€â”€ modules/                     # æ¨¡å—ä¸“å±ç›®å½•ï¼ˆæ¨¡å—+ç”¨æˆ·éš”ç¦»ï¼‰
â”‚   â”œâ”€â”€ report/                  # æ™ºèƒ½æŠ¥å‘Šæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ temp/                # ä¸´æ—¶æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ user_{id}/       # æŒ‰ç”¨æˆ·éš”ç¦»
â”‚   â”‚   â”‚       â””â”€â”€ report_{id}/ # æŒ‰æŠ¥å‘ŠIDåˆ†ç±»
â”‚   â”‚   â””â”€â”€ archive/             # å½’æ¡£æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ user_{id}/
â”‚   â”‚           â””â”€â”€ report_{id}/
â”‚   â””â”€â”€ analysis/                # å…¶ä»–æ¨¡å—...
â”‚
â””â”€â”€ system/                      # ç³»ç»Ÿçº§ç›®å½•ï¼ˆå¤‡ä»½ã€æ—¥å¿—ç­‰ï¼‰
    â”œâ”€â”€ backups/                 # æ•°æ®åº“å¤‡ä»½
    â””â”€â”€ logs/                    # ç³»ç»Ÿæ—¥å¿—
```

### 6.2 StorageManager API ä½¿ç”¨è§„èŒƒ

#### 6.2.1 è·å–ç”¨æˆ·ç§æœ‰ç›®å½•

```python
from utils.storage import get_storage_manager

storage_manager = get_storage_manager()

# è·å–ç”¨æˆ·ä¸Šä¼ ç›®å½•
user_upload_dir = storage_manager.get_user_dir(user_id=1, sub_dir="uploads")
# â†’ storage/users/user_1/uploads/

# è·å–ç”¨æˆ·å¯¼å‡ºç›®å½•
user_export_dir = storage_manager.get_user_dir(user_id=1, sub_dir="exports")
# â†’ storage/users/user_1/exports/
```

#### 6.2.2 è·å–æ¨¡å—ç›®å½•ï¼ˆæ”¯æŒç”¨æˆ·éš”ç¦»ï¼‰

```python
# è·å–æ¨¡å—ä¸´æ—¶ç›®å½•ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰
temp_dir = storage_manager.get_module_dir("report", "temp", user_id=1)
# â†’ storage/modules/report/temp/user_1/

# è·å–æ¨¡å—å½’æ¡£ç›®å½•ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰
archive_dir = storage_manager.get_module_dir("report", "archive", user_id=1)
# â†’ storage/modules/report/archive/user_1/

# è·å–æ¨¡å—åŸºç¡€ç›®å½•ï¼ˆä¸åŒºåˆ†ç”¨æˆ·ï¼Œç”¨äºç¡®ä¿ç›®å½•å­˜åœ¨ï¼‰
base_dir = storage_manager.get_module_dir("report")
# â†’ storage/modules/report/
```

#### 6.2.3 è·å–ç³»ç»Ÿçº§ç›®å½•

```python
# è·å–å¤‡ä»½ç›®å½•
backup_dir = storage_manager.get_system_dir("backups")
# â†’ storage/system/backups/

# è·å–æ—¥å¿—ç›®å½•
log_dir = storage_manager.get_system_dir("logs")
# â†’ storage/system/logs/
```

#### 6.2.4 åˆ é™¤ç”¨æˆ·æ‰€æœ‰æ–‡ä»¶

```python
# ç”¨æˆ·æ³¨é”€æ—¶ï¼Œåˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰æ–‡ä»¶
success = storage_manager.delete_user_files(user_id=1)
# åˆ é™¤ï¼š
# - storage/users/user_1/
# - storage/modules/*/*/user_1/
```

### 6.3 å­˜å‚¨è§„åˆ™æ€»ç»“

| åœºæ™¯ | ä½¿ç”¨ç›®å½• | API æ–¹æ³• | ç¤ºä¾‹è·¯å¾„ |
|-----|---------|---------|---------|
| **ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶** | `users/user_{id}/uploads/` | `get_user_dir(user_id, "uploads")` | `storage/users/user_1/uploads/` |
| **ç”¨æˆ·å¯¼å‡ºæ–‡ä»¶** | `users/user_{id}/exports/` | `get_user_dir(user_id, "exports")` | `storage/users/user_1/exports/` |
| **æ¨¡å—ä¸´æ—¶æ–‡ä»¶** | `modules/{module}/temp/user_{id}/` | `get_module_dir(module, "temp", user_id)` | `storage/modules/report/temp/user_1/` |
| **æ¨¡å—å½’æ¡£æ–‡ä»¶** | `modules/{module}/archive/user_{id}/` | `get_module_dir(module, "archive", user_id)` | `storage/modules/report/archive/user_1/` |
| **å…¬å…±èµ„æº** | `public/` | `storage_manager.public_dir` | `storage/public/avatars/` |
| **ç³»ç»Ÿå¤‡ä»½** | `system/backups/` | `get_system_dir("backups")` | `storage/system/backups/` |

### 6.4 å­˜å‚¨è§„èŒƒè¦æ±‚

1. **å¿…é¡»ä½¿ç”¨ StorageManager**ï¼šä¸¥ç¦ç›´æ¥ä½¿ç”¨ `os.path.join()` æˆ–ç¡¬ç¼–ç è·¯å¾„ï¼Œå¿…é¡»é€šè¿‡ `StorageManager` è·å–ç›®å½•
2. **å¿…é¡»æŒ‰ç”¨æˆ·éš”ç¦»**ï¼šæ‰€æœ‰ç”¨æˆ·ç›¸å…³æ–‡ä»¶å¿…é¡»æ”¾åœ¨ `user_{id}/` å­ç›®å½•ä¸‹
3. **å¿…é¡»æŒ‰æ¨¡å—åˆ†ç±»**ï¼šæ¨¡å—ç›¸å…³æ–‡ä»¶å¿…é¡»æ”¾åœ¨ `modules/{module_name}/` ä¸‹
4. **å¿…é¡»æ”¯æŒæ¸…ç†**ï¼šåˆ é™¤ç”¨æˆ·æˆ–æ¨¡å—æ—¶ï¼Œå¿…é¡»åŒæ—¶æ¸…ç†å¯¹åº”çš„æ–‡ä»¶ç›®å½•

---

## ä¸ƒã€ä¸‰å¤§æˆ’å¾‹ (Don'ts)

| æˆ’å¾‹ | è¯´æ˜ | åæœ |
| :--- | :--- | :--- |
| ğŸ”´ **ä¸¥ç¦åç«¯æ¸²æŸ“ HTML** | åç«¯åªèƒ½è¿”å› JSONã€‚æ‰€æœ‰ UI å¿…é¡»åœ¨å‰ç«¯ JS ä¸­æ¸²æŸ“ã€‚ | ç ´åå‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ— æ³•é™æ€åŒ–éƒ¨ç½²ã€‚ |
| ğŸ”´ **ä¸¥ç¦è·¨æ¨¡å— Import** | æ¨¡å—ä¹‹é—´ç¦æ­¢ `from modules.blog import x`ã€‚ | å¯¼è‡´æ¨¡å—å¼ºè€¦åˆï¼Œæ— æ³•ç‹¬ç«‹çƒ­æ’æ‹”ã€‚è¯·ä½¿ç”¨ **äº‹ä»¶æ€»çº¿** é€šä¿¡ã€‚ |
| ğŸ”´ **ä¸¥ç¦ç§é€ å“åº”æ ¼å¼** | å¿…é¡»ä½¿ç”¨ `schemas.success()` ç­‰å·¥å…·å‡½æ•°ã€‚ | å¯¼è‡´å‰ç«¯ API è§£æå™¨æ— æ³•ç»Ÿä¸€å¤„ç†é”™è¯¯ã€‚ |
