# JeJe WebOS å¼€å‘è§„èŒƒ

> ğŸ“˜ **å¼€å‘è§„èŒƒä¸æ¨¡å—å®æˆ˜æŒ‡å—**

æœ¬æ–‡æ¡£æ˜¯ JeJe WebOS çš„å®Œæ•´å¼€å‘è§„èŒƒï¼ŒåŒ…å«æ¶æ„çº¦æŸã€ä»£ç æ ‡å‡†ã€æ¨¡å—å¼€å‘æŒ‡å—å’Œå‰ç«¯å¼€å‘æ‰‹å†Œã€‚

---

## ğŸ“‘ ç›®å½•

1. [æ ¸å¿ƒæ¶æ„è§„èŒƒ](#ä¸€-æ ¸å¿ƒæ¶æ„è§„èŒƒ)
2. [é¡¹ç›®ç›®å½•ç»“æ„](#äºŒ-é¡¹ç›®ç›®å½•ç»“æ„)
3. [é€šç”¨å¼€å‘æ ‡å‡†](#ä¸‰-é€šç”¨å¼€å‘æ ‡å‡†)
4. [æ¨¡å—å¼€å‘å®æˆ˜](#å››-æ¨¡å—å¼€å‘å®æˆ˜)
5. [å‰ç«¯å¼€å‘æŒ‡å—](#äº”-å‰ç«¯å¼€å‘æŒ‡å—)
6. [å­˜å‚¨è§„èŒƒ](#å…­-å­˜å‚¨è§„èŒƒ)
7. [æ³¨é‡Šè§„èŒƒ](#ä¸ƒ-æ³¨é‡Šè§„èŒƒ)
8. [æµ‹è¯•è§„èŒƒ](#å…«-æµ‹è¯•è§„èŒƒ)
9. [ä¸‰å¤§æˆ’å¾‹](#ä¹-ä¸‰å¤§æˆ’å¾‹)

---

## ä¸€ã€æ ¸å¿ƒæ¶æ„è§„èŒƒ

### 1.1 æ¶æ„åˆ†å±‚

JeJe WebOS é‡‡ç”¨ **å¾®å†…æ ¸ (Micro-Kernel)** æ¶æ„ï¼Œä¸¥æ ¼åˆ’åˆ†ä¸º **å†…æ ¸å±‚ (Kernel)** ä¸ **åº”ç”¨å±‚ (Modules)**ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åº”ç”¨å±‚ (Modules)             â”‚
â”‚  blog, notes, feedback, analysis... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ä¾èµ–
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å†…æ ¸å±‚ (Core)                 â”‚
â”‚  Loader, EventBus, Security, DB     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒèŒè´£

| ç»„ä»¶ | èŒè´£ | ğŸ”´ ç¦åŒº |
|:---|:---|:---|
| **å†…æ ¸ (Core)** | æä¾›è´¦å·ã€é‰´æƒã€æ•°æ®åº“è¿æ¥ã€äº‹ä»¶æ€»çº¿ç­‰åŸºç¡€è®¾æ–½ | **ä¸¥ç¦åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘**ï¼ˆå¦‚æ–‡ç« ã€è®¢å•ï¼‰ |
| **æ¨¡å— (Modules)** | å®ç°å…·ä½“ä¸šåŠ¡åŠŸèƒ½ï¼ˆBlog, Notesï¼‰ | **ä¸¥ç¦ç›´æ¥ import å…¶ä»–æ¨¡å—ä»£ç ** |

### 1.3 æ¨¡å—é€šä¿¡

æ¨¡å—ä¹‹é—´ç¦æ­¢ç›´æ¥å¯¼å…¥ï¼Œå¿…é¡»é€šè¿‡ä»¥ä¸‹æ–¹å¼é€šä¿¡ï¼š

1. **äº‹ä»¶æ€»çº¿**ï¼šä½¿ç”¨ `core.events.event_bus` å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶
2. **æ•°æ®åº“å…³è”**ï¼šé€šè¿‡å¤–é”®å…³è”ï¼Œåœ¨ Service å±‚æŸ¥è¯¢å…³è”æ•°æ®
3. **API è°ƒç”¨**ï¼šé€šè¿‡ HTTP API è°ƒç”¨ï¼ˆä¸æ¨èï¼Œä»…ç”¨äºè·¨æœåŠ¡åœºæ™¯ï¼‰

---

## äºŒã€é¡¹ç›®ç›®å½•ç»“æ„

### 2.1 æ•´ä½“ç»“æ„

```
jeje_webos/
â”œâ”€â”€ backend/                      # åç«¯æ ¸å¿ƒ
â”‚   â”œâ”€â”€ core/                     # å†…æ ¸å±‚ï¼ˆç¦æ­¢ä¿®æ”¹ï¼‰
â”‚   â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ security.py           # å®‰å…¨è®¤è¯
â”‚   â”‚   â”œâ”€â”€ loader.py              # æ¨¡å—åŠ è½½å™¨
â”‚   â”‚   â”œâ”€â”€ middleware.py         # å…¨å±€ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ events.py             # äº‹ä»¶æ€»çº¿
â”‚   â”œâ”€â”€ modules/                  # åº”ç”¨å±‚ï¼ˆå¼€å‘ä¸»æˆ˜åœºï¼‰
â”‚   â”‚   â”œâ”€â”€ _template/            # æ¨¡å—ç”Ÿæˆæ¨¡æ¿
â”‚   â”‚   â””â”€â”€ {module_id}/          # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ routers/                  # ç³»ç»Ÿçº§è·¯ç”±
â”‚   â”œâ”€â”€ models/                   # ç³»ç»Ÿçº§æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/                  # ç³»ç»Ÿçº§ Schema
â”‚   â”œâ”€â”€ scripts/                  # å¼€å‘è„šæœ¬
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ tests/                    # æ ¸å¿ƒæµ‹è¯•
â”‚   â””â”€â”€ main.py                   # å¯åŠ¨å…¥å£
â”‚
â”œâ”€â”€ frontend/                     # å‰ç«¯æ¡Œé¢ç¯å¢ƒ
â”‚   â”œâ”€â”€ css/                      # æ ·å¼å±‚
â”‚   â”‚   â”œâ”€â”€ core/                 # åŸºç¡€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ components/           # ç»„ä»¶æ ·å¼
â”‚   â”‚   â””â”€â”€ pages/                # é¡µé¢æ ·å¼
â”‚   â”œâ”€â”€ js/                       # é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ components/           # UI ç»„ä»¶
â”‚   â”‚   â””â”€â”€ pages/                # ä¸šåŠ¡é¡µé¢
â”‚   â””â”€â”€ index.html                # å•é¡µå…¥å£
â”‚
â””â”€â”€ storage/                      # æ•°æ®æŒä¹…åŒ–
    â”œâ”€â”€ public/                   # å…¬å…±æ–‡ä»¶
    â”œâ”€â”€ users/                    # ç”¨æˆ·æ–‡ä»¶
    â”œâ”€â”€ modules/                  # æ¨¡å—æ–‡ä»¶
    â””â”€â”€ system/                   # ç³»ç»Ÿæ–‡ä»¶
```

### 2.2 æ¨¡å—å†…éƒ¨ç»“æ„

æ¯ä¸ªä¸šåŠ¡æ¨¡å—å¿…é¡»éµå¾ªä»¥ä¸‹å‘½åè§„èŒƒï¼ˆ**å¼ºåˆ¶å¸¦æœ‰æ¨¡å—å‰ç¼€**ï¼‰ï¼š

| æ–‡ä»¶å | å¿…é¡» | è¯´æ˜ |
|:---|:---:|:---|
| `__init__.py` | âœ… | ç©ºæ–‡ä»¶ï¼Œæ ‡è®°ä¸º Python åŒ… |
| `{id}_manifest.py` | âœ… | æ¨¡å—æ¸…å•ï¼Œå®šä¹‰å…ƒæ•°æ®ã€æƒé™ã€èœå•ã€ç”Ÿå‘½å‘¨æœŸ |
| `{id}_router.py` | âœ… | API è·¯ç”±å®šä¹‰ |
| `{id}_models.py` | âœ… | æ•°æ®åº“è¡¨ç»“æ„ï¼ˆSQLAlchemyï¼‰ |
| `{id}_schemas.py` | âœ… | æ•°æ®éªŒè¯æ¨¡å‹ï¼ˆPydanticï¼‰ |
| `{id}_services.py` | âšª | ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆæ¨èï¼‰ |
| `tests/` | âšª | æ¨¡å—æµ‹è¯•ç›®å½•ï¼ˆæ¨èï¼‰ |

> **è¯´æ˜**ï¼šæ‰€æœ‰æ¨¡å—æ–‡ä»¶å¿…é¡»å¸¦æœ‰ `{module_id}_` å‰ç¼€ï¼Œé˜²æ­¢ IDE ä¸­æœç´¢æ—¶å‡ºç°å¤§é‡åŒåæ–‡ä»¶ã€‚

---

## ä¸‰ã€é€šç”¨å¼€å‘æ ‡å‡†

### 3.1 å‘½åè§„èŒƒ

| å¯¹è±¡ | è§„èŒƒ | ç¤ºä¾‹ |
|:---|:---|:---|
| **æ–‡ä»¶å** | `{module_id}_` å‰ç¼€ | `blog_router.py` |
| **ç±»å** | PascalCase | `BlogPost`, `BlogService` |
| **å˜é‡/å‡½æ•°** | snake_case | `get_post_list`, `user_id` |
| **æ•°æ®åº“è¡¨** | `{module_id}_` å‰ç¼€ | `blog_posts`, `sys_users` |
| **API è·¯å¾„** | `/api/v1/{module}/{resource}` | `/api/v1/blog/posts` |
| **å¸¸é‡** | UPPER_SNAKE_CASE | `MAX_FILE_SIZE`, `DEFAULT_PAGE_SIZE` |

### 3.2 ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰ API å¿…é¡»è¿”å›ç»Ÿä¸€çš„ JSON ç»“æ„ï¼š

```python
# æˆåŠŸå“åº”
{
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "data": { ... }
}

# å¤±è´¥å“åº”
{
    "code": 400,
    "message": "å‚æ•°é”™è¯¯",
    "data": null
}

# åˆ†é¡µå“åº”
{
    "code": 200,
    "message": "success",
    "data": {
        "items": [...],
        "total": 100,
        "page": 1,
        "size": 10
    }
}
```

ä½¿ç”¨å·¥å…·å‡½æ•°ï¼š

```python
from schemas.response import success, error

# æˆåŠŸ
return success(data=result, message="æ“ä½œæˆåŠŸ")

# å¤±è´¥
return error(code=400, message="å‚æ•°é”™è¯¯")
```

### 3.3 æ•°æ®åº“æ¨¡å‹è§„èŒƒ

#### 3.3.1 ä¸¥ç¦ä½¿ç”¨å­—ç¬¦ä¸²å¼•ç”¨

åœ¨å®šä¹‰ `ForeignKey` å’Œ `relationship` æ—¶ï¼Œ**å¿…é¡»ä½¿ç”¨æ¨¡å‹ç±»æœ¬èº«**ï¼Œä¸¥ç¦ä½¿ç”¨å­—ç¬¦ä¸²ï¼š

```python
# âœ… æ­£ç¡®
from models import User

class BlogPost(Base):
    user_id: Mapped[int] = mapped_column(ForeignKey(User.id))
    user: Mapped[User] = relationship(User)

# âŒ é”™è¯¯
class BlogPost(Base):
    user_id: Mapped[int] = mapped_column(ForeignKey("sys_users.id"))
    user: Mapped["User"] = relationship("User")
```

#### 3.3.2 è·¨æ¨¡å—å…³ç³»å¤„ç†

é¿å…åœ¨ä¸åŒæ¨¡å—çš„æ¨¡å‹ä¹‹é—´å®šä¹‰åŒå‘ `relationship`ï¼š

```python
# âœ… æ­£ç¡®ï¼šåªä¿ç•™å¤–é”®ï¼Œåœ¨ Service å±‚æŸ¥è¯¢
class TransferSession(Base):
    sender_id: Mapped[int] = mapped_column(ForeignKey(User.id))
    # ä¸å®šä¹‰ relationship

# åœ¨ Service ä¸­æŸ¥è¯¢
user = await db.get(User, session.sender_id)

# âŒ é”™è¯¯ï¼šè·¨æ¨¡å— relationship
class TransferSession(Base):
    sender: Mapped[User] = relationship(User, backref="sessions")
```

#### 3.3.3 é¿å…ä½¿ç”¨ SQLAlchemy Enum ç±»å‹

å®šä¹‰æ•°æ®åº“åˆ—æ—¶ï¼Œ**ä½¿ç”¨ `String` ç±»å‹ä»£æ›¿ `Enum` ç±»å‹**ï¼š

```python
# âœ… æ­£ç¡®
from enum import Enum as PyEnum

class Status(str, PyEnum):
    PENDING = "pending"
    PUBLISHED = "published"

class BlogPost(Base):
    status: Mapped[str] = mapped_column(String(32), default=Status.PENDING.value)

# âŒ é”™è¯¯
from sqlalchemy import Enum
class BlogPost(Base):
    status: Mapped[Status] = mapped_column(Enum(Status))
```

#### 3.3.4 ç»Ÿä¸€å¯¼å…¥è·¯å¾„

æ‰€æœ‰æ¨¡å—å¯¼å…¥å¿…é¡»åŸºäºé¡¹ç›®æ ¹ç›®å½•ï¼ˆ`backend`ï¼‰ï¼Œä¸è¦ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ï¼š

```python
# âœ… æ­£ç¡®
from modules.transfer.models import TransferSession

# âŒ é”™è¯¯
from ..transfer.models import TransferSession
```

---

## å››ã€æ¨¡å—å¼€å‘å®æˆ˜

### 4.1 ä½¿ç”¨ CLI è„šæ‰‹æ¶ï¼ˆæ¨èï¼‰

**3 ç§’é’Ÿç”Ÿæˆå®Œæ•´æ¨¡å—ï¼š**

```bash
cd backend
python scripts/create_module.py <æ¨¡å—ID> <æ¨¡å—åç§°>

# ç¤ºä¾‹
python scripts/create_module.py todo_list å¾…åŠäº‹é¡¹
```

ç”Ÿæˆçš„ä»£ç åŒ…å«ï¼š
- ğŸ **åç«¯**ï¼šRouter, Service, Model, Schema
- ğŸ¨ **å‰ç«¯**ï¼šJS Page Component, CSS æ ·å¼
- ğŸ“œ **é…ç½®**ï¼šManifest è‡ªåŠ¨æ³¨å†Œ

### 4.2 æ‰‹åŠ¨å¼€å‘æµç¨‹

#### 4.2.1 å®šä¹‰æ¸…å• (`{id}_manifest.py`)

```python
from core.loader import ModuleManifest, ModuleAssets
import logging

logger = logging.getLogger(__name__)

# ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆå¯é€‰ï¼‰
async def on_install():
    """æ¨¡å—å®‰è£…æ—¶æ‰§è¡Œ"""
    logger.info("æ¨¡å—æ­£åœ¨å®‰è£…...")

async def on_enable():
    """æ¨¡å—å¯ç”¨æ—¶æ‰§è¡Œ"""
    logger.info("æ¨¡å—å·²å¯ç”¨")

async def on_disable():
    """æ¨¡å—ç¦ç”¨æ—¶æ‰§è¡Œ"""
    logger.info("æ¨¡å—å·²ç¦ç”¨")

manifest = ModuleManifest(
    # åŸºæœ¬ä¿¡æ¯
    id="todo",
    name="å¾…åŠäº‹é¡¹",
    version="1.0.0",
    description="ç®€å•é«˜æ•ˆçš„å¾…åŠäº‹é¡¹ç®¡ç†",
    icon="âœ…",
    author="JeJe WebOS",
    
    # è·¯ç”±é…ç½®
    router_prefix="/api/v1/todo",
    
    # èœå•é…ç½®
    menu={
        "title": "å¾…åŠ",
        "icon": "âœ…",
        "path": "/todo",
        "order": 10,
        "children": [
            {"title": "æˆ‘çš„å¾…åŠ", "path": "/todo/list", "icon": "ğŸ“"}
        ]
    },
    
    # å‰ç«¯èµ„æº
    assets=ModuleAssets(css=[], js=[]),
    
    # æƒé™å£°æ˜
    permissions=["todo.read", "todo.create", "todo.update", "todo.delete"],
    
    # æ¨¡å—ä¾èµ–
    dependencies=[],
    
    # å†…æ ¸ç‰ˆæœ¬è¦æ±‚
    kernel_version=">=1.0.0",
    
    # æ˜¯å¦å¯ç”¨
    enabled=True,
    
    # ç”Ÿå‘½å‘¨æœŸé’©å­
    on_install=on_install,
    on_enable=on_enable,
    on_disable=on_disable,
)
```

#### 4.2.2 å®šä¹‰æ•°æ®æ¨¡å‹ (`{id}_models.py`)

```python
from core.database import Base
from sqlalchemy.orm import Mapped, mapped_column
from sqlalchemy import Integer, String, DateTime, ForeignKey
from datetime import datetime
from models import User

class TodoItem(Base):
    __tablename__ = "todo_items"  # âš ï¸ å¿…é¡»å¸¦æ¨¡å—å‰ç¼€
    
    id: Mapped[int] = mapped_column(Integer, primary_key=True)
    user_id: Mapped[int] = mapped_column(ForeignKey(User.id))
    title: Mapped[str] = mapped_column(String(200))
    completed: Mapped[bool] = mapped_column(default=False)
    created_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.now)
    updated_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.now, onupdate=datetime.now)
```

#### 4.2.3 å®šä¹‰ Schema (`{id}_schemas.py`)

```python
from pydantic import BaseModel
from datetime import datetime

class TodoCreate(BaseModel):
    title: str
    completed: bool = False

class TodoUpdate(BaseModel):
    title: str | None = None
    completed: bool | None = None

class TodoResponse(BaseModel):
    id: int
    user_id: int
    title: str
    completed: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True
```

#### 4.2.4 ç¼–å†™ä¸šåŠ¡é€»è¾‘ (`{id}_services.py`)

```python
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from .todo_models import TodoItem
from .todo_schemas import TodoCreate, TodoUpdate

class TodoService:
    @staticmethod
    async def create_todo(db: AsyncSession, user_id: int, data: TodoCreate) -> TodoItem:
        todo = TodoItem(user_id=user_id, **data.model_dump())
        db.add(todo)
        await db.commit()
        await db.refresh(todo)
        return todo
    
    @staticmethod
    async def get_todo_list(db: AsyncSession, user_id: int, skip: int = 0, limit: int = 10):
        stmt = select(TodoItem).where(TodoItem.user_id == user_id).offset(skip).limit(limit)
        result = await db.execute(stmt)
        return result.scalars().all()
```

#### 4.2.5 ç¼–å†™ API è·¯ç”± (`{id}_router.py`)

```python
from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from core.database import get_db
from core.security import get_current_user, TokenData
from schemas.response import success
from .todo_schemas import TodoCreate, TodoUpdate, TodoResponse
from .todo_services import TodoService

router = APIRouter()

@router.post("/", response_model=dict)
async def create_todo(
    data: TodoCreate,
    db: AsyncSession = Depends(get_db),
    user: TokenData = Depends(get_current_user)
):
    todo = await TodoService.create_todo(db, user.user_id, data)
    return success(data=TodoResponse.model_validate(todo).model_dump())

@router.get("/", response_model=dict)
async def get_todo_list(
    skip: int = 0,
    limit: int = 10,
    db: AsyncSession = Depends(get_db),
    user: TokenData = Depends(get_current_user)
):
    todos = await TodoService.get_todo_list(db, user.user_id, skip, limit)
    return success(data=[TodoResponse.model_validate(t).model_dump() for t in todos])
```

### 4.3 æ¨¡å—æ‰“åŒ…ä¸å‘å¸ƒ

#### 4.3.1 ä½¿ç”¨æ‰“åŒ…è„šæœ¬

```bash
cd backend
python scripts/pack_module.py <module_id>

# ç¤ºä¾‹
python scripts/pack_module.py todo
```

ç”Ÿæˆçš„ `.jwapp` æ–‡ä»¶ä½äº `dist/` ç›®å½•ã€‚

#### 4.3.2 æ‰“åŒ…æ ¼å¼

`.jwapp` æ˜¯ä¸€ä¸ª ZIP å‹ç¼©åŒ…ï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
todo.jwapp (ZIP Archive)
â””â”€â”€ todo/                   # å¿…é¡»åŒ…å«ä¸€å±‚ä»¥æ¨¡å—IDå‘½åçš„æ ¹æ–‡ä»¶å¤¹
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ todo_manifest.py
    â”œâ”€â”€ todo_router.py
    â””â”€â”€ ...
```

> âš ï¸ **æ³¨æ„**ï¼šå‹ç¼©åŒ…å†…**å¿…é¡»**åŒ…å«é¡¶å±‚çš„æ–‡ä»¶å¤¹ï¼Œä¸èƒ½ç›´æ¥å°†æ–‡ä»¶æ”¾åœ¨å‹ç¼©åŒ…æ ¹ç›®å½•ã€‚

---

## äº”ã€å‰ç«¯å¼€å‘æŒ‡å—

### 5.1 é¡µé¢ç»„ä»¶å¼€å‘

åœ¨ `frontend/js/pages/` ä¸­åˆ›å»ºé¡µé¢ç»„ä»¶ï¼š

```javascript
// frontend/js/pages/todo.js
class TodoPage extends Component {
    constructor(container) {
        super(container);
        this.state = {
            list: [],
            loading: false
        };
    }

    render() {
        const { list, loading } = this.state;
        return `
            <div class="page-todo">
                <h1>å¾…åŠäº‹é¡¹</h1>
                ${loading ? '<div>åŠ è½½ä¸­...</div>' : ''}
                <ul>
                    ${list.map(item => `<li>${item.title}</li>`).join('')}
                </ul>
            </div>
        `;
    }

    async afterMount() {
        const res = await Api.get('/todo/');
        this.setState({ list: res.data });
    }
}
```

### 5.2 æ³¨å†Œè·¯ç”±

åœ¨ `frontend/js/pages/app.js` ä¸­æ³¨å†Œé¡µé¢ï¼š

```javascript
'/todo/list': { 
    auth: true, 
    handler: wrap(TodoPage, 'å¾…åŠäº‹é¡¹') 
}
```

### 5.3 JS/CSS æ–‡ä»¶å‘½åä¸å­˜æ”¾è§„èŒƒ

#### 5.3.1 æ–‡ä»¶å‘½åè§„åˆ™

**æ ¸å¿ƒåŸåˆ™ï¼šJS å’Œ CSS æ–‡ä»¶å¿…é¡»ä¸€ä¸€å¯¹åº”ï¼Œä¸”æ–‡ä»¶åä¿æŒä¸€è‡´ã€‚**

| æ–‡ä»¶ç±»å‹ | å‘½åè§„åˆ™ | ç¤ºä¾‹ |
|---------|---------|------|
| **é¡µé¢ JS** | `{module_id}.js` æˆ– `{module_id}_{page_name}.js` | `todo.js`, `analysis_chart.js` |
| **é¡µé¢ CSS** | **å¿…é¡»ä¸ JS æ–‡ä»¶åå®Œå…¨ä¸€è‡´** | `todo.css`, `analysis_chart.css` |
| **ç»„ä»¶ JS** | `{component_name}.js` | `window.js`, `dock.js` |
| **ç»„ä»¶ CSS** | **å¿…é¡»ä¸ JS æ–‡ä»¶åå®Œå…¨ä¸€è‡´** | `window.css`, `dock.css` |

#### 5.3.2 æ–‡ä»¶å­˜æ”¾è§„åˆ™

**ç›®å½•ç»“æ„å¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„èŒƒï¼š**

```
frontend/
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ components/              # UI ç»„ä»¶
â”‚   â””â”€â”€ pages/                   # é¡µé¢ç»„ä»¶
â”‚       â”œâ”€â”€ todo.js
â”‚       â”œâ”€â”€ analysis/
â”‚       â”‚   â”œâ”€â”€ analysis.js
â”‚       â”‚   â””â”€â”€ analysis_chart.js
â”‚       â””â”€â”€ datalens/
â”‚           â””â”€â”€ datalens.js
â”‚
â””â”€â”€ css/
    â”œâ”€â”€ core/                    # æ ¸å¿ƒæ ·å¼
    â”œâ”€â”€ components/              # ç»„ä»¶æ ·å¼
    â””â”€â”€ pages/                   # é¡µé¢æ ·å¼ï¼ˆä¸ js/pages/ å¯¹åº”ï¼‰
        â”œâ”€â”€ todo.css
        â”œâ”€â”€ analysis/
        â”‚   â”œâ”€â”€ analysis.css
        â”‚   â””â”€â”€ analysis_chart.css
        â””â”€â”€ datalens/
            â””â”€â”€ datalens.css
```

**å­˜æ”¾è§„åˆ™ï¼š**
1. **ç›®å½•å¯¹åº”**ï¼š`js/pages/` ä¸­çš„æ–‡ä»¶å¿…é¡»åœ¨ `css/pages/` ä¸­æœ‰å¯¹åº”çš„ CSS æ–‡ä»¶
2. **å­ç›®å½•ä¸€è‡´**ï¼šå¦‚æœ JS æ–‡ä»¶åœ¨å­ç›®å½•ä¸­ï¼ŒCSS æ–‡ä»¶ä¹Ÿå¿…é¡»åœ¨ç›¸åŒçš„å­ç›®å½•ä¸­
3. **æ–‡ä»¶åä¸€è‡´**ï¼šCSS æ–‡ä»¶åå¿…é¡»ä¸å¯¹åº”çš„ JS æ–‡ä»¶åå®Œå…¨ä¸€è‡´

---

## å…­ã€å­˜å‚¨è§„èŒƒ

### 6.1 å­˜å‚¨ç›®å½•ç»“æ„

```
storage/
â”œâ”€â”€ public/                      # å…¬å…±æ–‡ä»¶ï¼ˆä¸åŒºåˆ†ç”¨æˆ·ï¼‰
â”‚   â”œâ”€â”€ avatars/                # ç”¨æˆ·å¤´åƒ
â”‚   â””â”€â”€ attachments/            # å…¬å…±é™„ä»¶
â”‚
â”œâ”€â”€ users/                      # ç”¨æˆ·ç§æœ‰æ–‡ä»¶ï¼ˆæŒ‰ç”¨æˆ·IDéš”ç¦»ï¼‰
â”‚   â””â”€â”€ user_{id}/              # å•ä¸ªç”¨æˆ·çš„æ‰€æœ‰ç§æœ‰æ–‡ä»¶
â”‚       â”œâ”€â”€ uploads/            # ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶
â”‚       â””â”€â”€ exports/             # ç”¨æˆ·å¯¼å‡ºçš„æ–‡ä»¶
â”‚
â”œâ”€â”€ modules/                     # æ¨¡å—ä¸“å±ç›®å½•ï¼ˆæ¨¡å—+ç”¨æˆ·éš”ç¦»ï¼‰
â”‚   â”œâ”€â”€ report/                  # æ™ºèƒ½æŠ¥å‘Šæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ temp/                # ä¸´æ—¶æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ user_{id}/       # æŒ‰ç”¨æˆ·éš”ç¦»
â”‚   â”‚   â””â”€â”€ archive/             # å½’æ¡£æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ user_{id}/
â”‚   â””â”€â”€ analysis/                # å…¶ä»–æ¨¡å—...
â”‚
â””â”€â”€ system/                      # ç³»ç»Ÿçº§ç›®å½•
    â”œâ”€â”€ backups/                 # æ•°æ®åº“å¤‡ä»½
    â””â”€â”€ logs/                    # ç³»ç»Ÿæ—¥å¿—
```

### 6.2 StorageManager API ä½¿ç”¨è§„èŒƒ

#### 6.2.1 è·å–ç”¨æˆ·ç§æœ‰ç›®å½•

```python
from utils.storage import get_storage_manager

storage_manager = get_storage_manager()

# è·å–ç”¨æˆ·ä¸Šä¼ ç›®å½•
user_upload_dir = storage_manager.get_user_dir(user_id=1, sub_dir="uploads")
# â†’ storage/users/user_1/uploads/

# è·å–ç”¨æˆ·å¯¼å‡ºç›®å½•
user_export_dir = storage_manager.get_user_dir(user_id=1, sub_dir="exports")
# â†’ storage/users/user_1/exports/
```

#### 6.2.2 è·å–æ¨¡å—ç›®å½•

```python
# è·å–æ¨¡å—ä¸´æ—¶ç›®å½•ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰
temp_dir = storage_manager.get_module_dir("report", "temp", user_id=1)
# â†’ storage/modules/report/temp/user_1/

# è·å–æ¨¡å—å½’æ¡£ç›®å½•ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰
archive_dir = storage_manager.get_module_dir("report", "archive", user_id=1)
# â†’ storage/modules/report/archive/user_1/
```

#### 6.2.3 è·å–ç³»ç»Ÿçº§ç›®å½•

```python
# è·å–å¤‡ä»½ç›®å½•
backup_dir = storage_manager.get_system_dir("backups")
# â†’ storage/system/backups/
```

### 6.3 å­˜å‚¨è§„èŒƒè¦æ±‚

1. **å¿…é¡»ä½¿ç”¨ StorageManager**ï¼šä¸¥ç¦ç›´æ¥ä½¿ç”¨ `os.path.join()` æˆ–ç¡¬ç¼–ç è·¯å¾„
2. **å¿…é¡»æŒ‰ç”¨æˆ·éš”ç¦»**ï¼šæ‰€æœ‰ç”¨æˆ·ç›¸å…³æ–‡ä»¶å¿…é¡»æ”¾åœ¨ `user_{id}/` å­ç›®å½•ä¸‹
3. **å¿…é¡»æŒ‰æ¨¡å—åˆ†ç±»**ï¼šæ¨¡å—ç›¸å…³æ–‡ä»¶å¿…é¡»æ”¾åœ¨ `modules/{module_name}/` ä¸‹
4. **å¿…é¡»æ”¯æŒæ¸…ç†**ï¼šåˆ é™¤ç”¨æˆ·æˆ–æ¨¡å—æ—¶ï¼Œå¿…é¡»åŒæ—¶æ¸…ç†å¯¹åº”çš„æ–‡ä»¶ç›®å½•

---

## ä¸ƒã€æ³¨é‡Šè§„èŒƒ

### 7.1 æ³¨é‡Šè¯­è¨€

**æ‰€æœ‰æ³¨é‡Šå¿…é¡»ä½¿ç”¨ä¸­æ–‡**ï¼ŒåŒ…æ‹¬ï¼š
- æ–‡ä»¶å¤´éƒ¨è¯´æ˜
- å‡½æ•°/ç±»æ–‡æ¡£å­—ç¬¦ä¸²
- è¡Œå†…æ³¨é‡Š
- TODO/FIXME æ³¨é‡Š

### 7.2 æ³¨é‡Šç±»å‹

åªä¿ç•™**åŠŸèƒ½æ€§æ³¨é‡Š**ï¼Œç§»é™¤ä»¥ä¸‹ç±»å‹çš„æ³¨é‡Šï¼š
- âŒ è°ƒè¯•æ³¨é‡Šï¼ˆå¦‚ `# è°ƒè¯•ï¼šæ‰“å°å˜é‡`ï¼‰
- âŒ å¼€å‘æç¤ºï¼ˆå¦‚ `# æ³¨æ„ï¼šè¿™é‡Œéœ€è¦ä¼˜åŒ–`ï¼‰
- âŒ æé†’æ³¨é‡Šï¼ˆå¦‚ `# æé†’ï¼šè®°å¾—æ›´æ–°`ï¼‰
- âŒ åºŸé™¤æ³¨é‡Šï¼ˆå¦‚ `# å·²åºŸé™¤ï¼Œä½¿ç”¨æ–°æ–¹æ³•`ï¼‰
- âŒ æ–°å¢æ ‡è®°ï¼ˆå¦‚ `# æ–°å¢ï¼šæ·»åŠ äº†åŠŸèƒ½`ï¼‰

### 7.3 æ³¨é‡Šç¤ºä¾‹

```python
# âœ… æ­£ç¡®ï¼šåŠŸèƒ½æ€§æ³¨é‡Š
# è·å–ç”¨æˆ·ä¸Šä¼ ç›®å½•
user_dir = storage_manager.get_user_dir(user_id, "uploads")

# âŒ é”™è¯¯ï¼šè°ƒè¯•æ³¨é‡Š
# è°ƒè¯•ï¼šæ‰“å°ç”¨æˆ·ç›®å½•
print(user_dir)

# âŒ é”™è¯¯ï¼šæé†’æ³¨é‡Š
# æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æ£€æŸ¥æƒé™
```

---

## å…«ã€æµ‹è¯•è§„èŒƒ

### 8.1 æµ‹è¯•ç›®å½•ç»“æ„

```
modules/todo/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ todo_manifest.py
â”œâ”€â”€ todo_router.py
â””â”€â”€ tests/                  # æµ‹è¯•ç›®å½•
    â”œâ”€â”€ __init__.py         # å¿…é¡»
    â””â”€â”€ test_todo.py        # æµ‹è¯•æ–‡ä»¶
```

### 8.2 æµ‹è¯•ç¤ºä¾‹

```python
# modules/todo/tests/test_todo.py
import pytest
from modules.todo.todo_services import TodoService
from modules.todo.todo_schemas import TodoCreate

class TestTodoService:
    def test_create_todo(self):
        """æµ‹è¯•åˆ›å»ºå¾…åŠ"""
        # æµ‹è¯•é€»è¾‘
        pass
```

### 8.3 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå•ä¸ªæ¨¡å—çš„æµ‹è¯•
python -m pytest modules/todo/tests/ -v

# è¿è¡Œæ‰€æœ‰æ¨¡å—æµ‹è¯•
python -m pytest modules/*/tests/ -v

# è¿è¡Œæ ¸å¿ƒæµ‹è¯• + æ¨¡å—æµ‹è¯•
python -m pytest tests/ modules/*/tests/ -v
```

---

## ä¹ã€ä¸‰å¤§æˆ’å¾‹

| æˆ’å¾‹ | è¯´æ˜ | åæœ |
|:---|:---|:---|
| ğŸ”´ **ä¸¥ç¦åç«¯æ¸²æŸ“ HTML** | åç«¯åªèƒ½è¿”å› JSONã€‚æ‰€æœ‰ UI å¿…é¡»åœ¨å‰ç«¯ JS ä¸­æ¸²æŸ“ã€‚ | ç ´åå‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ— æ³•é™æ€åŒ–éƒ¨ç½²ã€‚ |
| ğŸ”´ **ä¸¥ç¦è·¨æ¨¡å— Import** | æ¨¡å—ä¹‹é—´ç¦æ­¢ `from modules.blog import x`ã€‚ | å¯¼è‡´æ¨¡å—å¼ºè€¦åˆï¼Œæ— æ³•ç‹¬ç«‹çƒ­æ’æ‹”ã€‚è¯·ä½¿ç”¨ **äº‹ä»¶æ€»çº¿** é€šä¿¡ã€‚ |
| ğŸ”´ **ä¸¥ç¦ç§é€ å“åº”æ ¼å¼** | å¿…é¡»ä½¿ç”¨ `schemas.success()` ç­‰å·¥å…·å‡½æ•°ã€‚ | å¯¼è‡´å‰ç«¯ API è§£æå™¨æ— æ³•ç»Ÿä¸€å¤„ç†é”™è¯¯ã€‚ |

---

## ğŸ“š é™„å½•

### A. å¸¸ç”¨å·¥å…·å‡½æ•°

```python
# å“åº”å°è£…
from schemas.response import success, error

# æƒé™æ£€æŸ¥
from core.security import require_permission

# æ•°æ®åº“ä¼šè¯
from core.database import get_db

# å½“å‰ç”¨æˆ·
from core.security import get_current_user

# å­˜å‚¨ç®¡ç†
from utils.storage import get_storage_manager

# äº‹ä»¶å‘å¸ƒ
from core.events import event_bus, Events
await event_bus.publish(Event(name=Events.USER_CREATED, data={...}))
```

### B. æ¨¡å—å¼€å‘æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æ–‡ä»¶å·²ä½¿ç”¨ `{module_id}_` å‰ç¼€å‘½å
- [ ] æ•°æ®åº“è¡¨åå·²ä½¿ç”¨ `{module_id}_` å‰ç¼€
- [ ] Manifest å·²æ­£ç¡®é…ç½®æƒé™ã€èœå•ã€è·¯ç”±
- [ ] æœªç›´æ¥ import å…¶ä»–æ¨¡å—ä»£ç 
- [ ] ä½¿ç”¨ `StorageManager` ç®¡ç†æ–‡ä»¶å­˜å‚¨
- [ ] API å“åº”ä½¿ç”¨ç»Ÿä¸€çš„ `success()` å’Œ `error()` å‡½æ•°
- [ ] æ‰€æœ‰æ³¨é‡Šä¸ºä¸­æ–‡åŠŸèƒ½æ€§æ³¨é‡Š
- [ ] å·²ç¼–å†™å•å…ƒæµ‹è¯•

---

**æœ€åæ›´æ–°**ï¼š2026-01-02
