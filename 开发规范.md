# JeJe WebOS å¼€å‘æ‰‹å†Œ

> ğŸ“˜ **å¼€å‘è§„èŒƒä¸æ¨¡å—å®æˆ˜åˆé›†**
> 
> æœ¬æ–‡æ¡£èåˆäº†ç³»ç»Ÿå¼€å‘è§„èŒƒä¸æ¨¡å—å¼€å‘æŒ‡å—ï¼Œæ—¢æ˜¯æ¶æ„çº¦æŸçš„"æ³•å¾‹æ³•è§„"ï¼Œä¹Ÿæ˜¯ä¸šåŠ¡å¼€å‘çš„"æ“ä½œæ‰‹å†Œ"ã€‚

---

## ğŸ“‘ ç›®å½•

1. **[æ ¸å¿ƒæ¶æ„è§„èŒƒ](#ä¸€-æ ¸å¿ƒæ¶æ„è§„èŒƒ)** (Design Principles)
2. **[é¡¹ç›®ç›®å½•ç»“æ„](#äºŒ-é¡¹ç›®ç›®å½•ç»“æ„)** (Directory Structure)
3. **[é€šç”¨å¼€å‘æ ‡å‡†](#ä¸‰-é€šç”¨å¼€å‘æ ‡å‡†)** (Naming & API Standards)
4. **[æ¨¡å—å¼€å‘å®æˆ˜](#å››-æ¨¡å—å¼€å‘å®æˆ˜-module-development)** (Build Your App)
5. **[å‰ç«¯å¼€å‘æŒ‡å—](#äº”-å‰ç«¯å¼€å‘æŒ‡å—)** (Frontend Development)
6. **[ä¸‰å¤§æˆ’å¾‹](#å…­-ä¸‰å¤§æˆ’å¾‹-donts)** (Critical Rules)

---

## ä¸€ã€æ ¸å¿ƒæ¶æ„è§„èŒƒ

JeJe WebOS é‡‡ç”¨ **å¾®å†…æ ¸ (Micro-Kernel)** æ¶æ„ï¼Œä¸¥æ ¼éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

### 1.1 æ¶æ„åˆ†å±‚
ç³»ç»Ÿä¸¥æ ¼åˆ’åˆ†ä¸º **å†…æ ¸å±‚ (Kernel)** ä¸ **åº”ç”¨å±‚ (Modules)**ã€‚

```mermaid
graph TD
    A[åº”ç”¨å±‚ Modules] -->|ä¾èµ–| B(å†…æ ¸å±‚ Kernel)
    B -->|åŠ è½½| A
    subgraph Core[å†…æ ¸åŸºç¡€è®¾æ–½]
        Loader[åŠ è½½å™¨]
        EventBus[äº‹ä»¶æ€»çº¿]
        Security[å®‰å…¨è®¤è¯]
        Database[æ•°æ®åº“è¿æ¥]
    end
    subgraph Apps[ä¸šåŠ¡æ¨¡å—]
        Blog[åšå®¢]
        Notes[éšæ‰‹è®°]
        Feedback[åé¦ˆ]
    end
```

### 1.2 æ ¸å¿ƒèŒè´£

| ç»„ä»¶ | èŒè´£ | ğŸ”´ ç¦åŒº |
| :--- | :--- | :--- |
| **å†…æ ¸ (Core)** | æä¾›è´¦å·ã€é‰´æƒã€æ•°æ®åº“è¿æ¥ã€äº‹ä»¶æ€»çº¿ç­‰åŸºç¡€è®¾æ–½ | **ä¸¥ç¦åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘** (å¦‚æ–‡ç« ã€è®¢å•) |
| **æ¨¡å— (Modules)** | å®ç°å…·ä½“ä¸šåŠ¡åŠŸèƒ½ (Blog, Notes) | **ä¸¥ç¦ç›´æ¥ import å…¶ä»–æ¨¡å—ä»£ç ** |

---

## äºŒã€é¡¹ç›®ç›®å½•ç»“æ„

### 2.1 æ•´ä½“ç»“æ„

```text
jeje_webos/
â”œâ”€â”€ backend/                      # ğŸ åç«¯ (FastAPI)
â”‚   â”œâ”€â”€ core/                     # --- å†…æ ¸å±‚ (ç¦æ­¢ä¿®æ”¹) ---
â”‚   â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py           # DB è¿æ¥ä¸ Session
â”‚   â”‚   â”œâ”€â”€ loader.py             # æ¨¡å—åŠ è½½å™¨
â”‚   â”‚   â””â”€â”€ security.py           # JWT ä¸ æƒé™æ ¡éªŒ
â”‚   â”œâ”€â”€ modules/                  # --- åº”ç”¨å±‚ (å¼€å‘ä¸»æˆ˜åœº) ---
â”‚   â”‚   â”œâ”€â”€ _template/            # æ¨¡å—ç”Ÿæˆæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ blog/                 # [ç¤ºä¾‹] åšå®¢æ¨¡å—
â”‚   â”‚   â””â”€â”€ notes/                # [ç¤ºä¾‹] ç¬”è®°æ¨¡å—
â”‚   â”œâ”€â”€ routers/                  # ç³»ç»Ÿçº§è·¯ç”± (Auth, System)
â”‚   â”œâ”€â”€ models/                   # ç³»ç»Ÿçº§æ¨¡å‹ (User, Role)
â”‚   â””â”€â”€ main.py                   # å¯åŠ¨å…¥å£
â”‚
â”œâ”€â”€ frontend/                     # ğŸ¨ å‰ç«¯ (Vanilla JS)
â”‚   â”œâ”€â”€ js/                       # --- é€»è¾‘å±‚ ---
â”‚   â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒåº“ (Router, Store, Api)
â”‚   â”‚   â”œâ”€â”€ components/           # UI ç»„ä»¶ (Window, Dock)
â”‚   â”‚   â””â”€â”€ pages/                # é¡µé¢ç»„ä»¶
â”‚   â””â”€â”€ css/                      # --- æ ·å¼å±‚ ---
```

### 2.2 æ¨¡å—å†…éƒ¨ç»“æ„ (`backend/modules/xxx/`)

æ¯ä¸ªä¸šåŠ¡æ¨¡å—å¿…é¡»éµå¾ªä»¥ä¸‹å‘½åè§„èŒƒï¼ˆå¼ºåˆ¶å¸¦æœ‰æ¨¡å—å‰ç¼€ï¼‰ï¼Œä»¥ä¾¿äºåœ¨ IDE ä¸­å¿«é€ŸåŒºåˆ†ï¼š

| æ–‡ä»¶å | å¿…é¡» | è¯´æ˜ |
| :--- | :---: | :--- |
| `__init__.py` | âœ… | ç©ºæ–‡ä»¶ï¼Œæ ‡è®°ä¸º Python åŒ… |
| `{id}_manifest.py` | âœ… | **æ¨¡å—èº«ä»½è¯**ï¼Œå®šä¹‰åç§°ã€å›¾æ ‡ã€æƒé™ã€èœå• |
| `{id}_router.py` | âœ… | API è·¯ç”±å®šä¹‰ |
| `{id}_models.py` | âœ… | æ•°æ®åº“è¡¨ç»“æ„ (SQLAlchemy) |
| `{id}_schemas.py` | âœ… | æ•°æ®éªŒè¯æ¨¡å‹ (Pydantic) |
| `{id}_services.py` | âšª | ä¸šåŠ¡é€»è¾‘å±‚ (æ¨è) |

> â„¹ï¸ **è¯´æ˜**ï¼šä¸ºäº†é˜²æ­¢åœ¨ IDEï¼ˆå¦‚ VS Codeï¼‰ä¸­æœç´¢æ–‡ä»¶æ—¶å‡ºç°å¤§é‡åŒåæ–‡ä»¶ï¼ˆå¦‚ `router.py`ï¼‰ï¼Œæ‰€æœ‰æ¨¡å—æ–‡ä»¶å¿…é¡»å¸¦æœ‰ `{module_id}_` å‰ç¼€ã€‚

---

## ä¸‰ã€é€šç”¨å¼€å‘æ ‡å‡†

### 3.1 å‘½åè§„èŒƒ

| å¯¹è±¡ | è§„èŒƒ | ç¤ºä¾‹ |
| :--- | :--- | :--- |
| **æ–‡ä»¶å** | `{module_id}_` å‰ç¼€ | `blog_router.py` |
| **ç±»å** | PascalCase | `BlogPost`, `BlogService` |
| **å˜é‡/å‡½æ•°** | snake_case | `get_post_list`, `user_id` |
| **æ•°æ®åº“è¡¨** | `{module_id}_` å‰ç¼€ | `blog_posts`, `sys_users` |
| **API è·¯å¾„** | `/api/v1/{module}/{resource}` | `/api/v1/blog/posts` |

### 3.2 ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰ API å¿…é¡»è¿”å›ç»Ÿä¸€çš„ JSON ç»“æ„ï¼š

```json
// æˆåŠŸ
{ "code": 200, "message": "æ“ä½œæˆåŠŸ", "data": { ... } }

// å¤±è´¥
{ "code": 400, "message": "å‚æ•°é”™è¯¯", "data": null }

// åˆ†é¡µ
{ 
    "code": 200, 
    "message": "success", 
    "data": { "items": [...], "total": 100, "page": 1, "size": 10 } 
}
```

---

## å››ã€æ¨¡å—å¼€å‘å®æˆ˜ (Module Development)

æœ¬èŠ‚æŒ‡å¯¼ä½ å¦‚ä½•ä»é›¶åˆ›å»ºä¸€ä¸ªæ–°æ¨¡å—ï¼ˆå¦‚ "å¾…åŠäº‹é¡¹" `todo`ï¼‰ã€‚

### ğŸš€ æ–¹å¼ä¸€ï¼šä½¿ç”¨ CLI è„šæ‰‹æ¶ (æ¨è)

**3ç§’é’Ÿç”Ÿæˆå®Œæ•´æ¨¡å—ï¼š**

```bash
cd backend
python scripts/create_module.py todo å¾…åŠäº‹é¡¹
```

æ­¤å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆåç«¯ä»£ç  (`backend/modules/todo/`) å’Œå‰ç«¯ä»£ç  (`frontend/js/pages/todo.js`)ã€‚é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆã€‚

### ğŸ› ï¸ æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¼€å‘æµç¨‹

#### 1. å®šä¹‰æ¸…å• (`manifest.py`)
è¿™æ˜¯æ¨¡å—çš„å…¥å£ï¼Œç³»ç»Ÿæ ¹æ®æ­¤æ–‡ä»¶åŠ è½½æ¨¡å—ã€‚

```python
from core.loader import ModuleManifest

manifest = ModuleManifest(
    id="todo",
    name="å¾…åŠäº‹é¡¹",
    icon="âœ…",
    # è‡ªåŠ¨æŒ‚è½½è·¯ç”±: /api/v1/todo
    router_prefix="/api/v1/todo",
    
    # è‡ªåŠ¨æ³¨å†Œå‰ç«¯èœå•
    menu={
        "title": "å¾…åŠ",
        "icon": "âœ…",
        "path": "/todo",
        "children": [
            {"title": "æˆ‘çš„å¾…åŠ", "path": "/todo/list", "icon": "ğŸ“"},
            {"title": "æ–°å»ºä»»åŠ¡", "path": "/todo/add", "icon": "â•"}
        ]
    },
    
    # å®šä¹‰æƒé™ç‚¹
    permissions=["todo.read", "todo.create"]
)
```

#### 2. å®šä¹‰æ•°æ®æ¨¡å‹ (`models.py`)

```python
from core.database import Base
from sqlalchemy.orm import Mapped, mapped_column
from sqlalchemy import Integer, String

class TodoItem(Base):
    # âš ï¸ å¿…é¡»å¸¦æ¨¡å—å‰ç¼€ todo_
    __tablename__ = "todo_items"
    
    id: Mapped[int] = mapped_column(Integer, primary_key=True)
    title: Mapped[str] = mapped_column(String(100))
```

#### 3. ç¼–å†™ API (`router.py`)

```python
from fastapi import APIRouter, Depends
from core.database import get_db
from schemas import success  # ç»Ÿä¸€å“åº”å°è£…

router = APIRouter()

@router.get("/list")
async def get_list(db = Depends(get_db)):
    # ... ä¸šåŠ¡é€»è¾‘
    return success(data)
```

---

## äº”ã€å‰ç«¯å¼€å‘æŒ‡å—

JeJe WebOS å‰ç«¯é‡‡ç”¨ **Vanilla JS Component** æ¨¡å¼ï¼Œæ— éœ€æ„å»ºå·¥å…·ã€‚

### 5.1 é¡µé¢ç»„ä»¶å¼€å‘

åœ¨ `frontend/js/pages/` ä¸­åˆ›å»º `todo.js`ï¼š

```javascript
// å¿…é¡»ç»§æ‰¿ Component åŸºç±»
class TodoPage extends Component {
    constructor(container) {
        super(container);
        // å®šä¹‰å“åº”å¼çŠ¶æ€
        this.state = {
            list: [],
            loading: false
        };
    }

    // æ¸²æŸ“ HTML (ç±»ä¼¼ React render)
    render() {
        const { list } = this.state;
        return `
            <div class="page-todo">
                <h1>å¾…åŠäº‹é¡¹</h1>
                <ul>
                    ${list.map(item => `<li>${item.title}</li>`).join('')}
                </ul>
            </div>
        `;
    }

    // ç”Ÿå‘½å‘¨æœŸï¼šæŒ‚è½½åæ‰§è¡Œ
    async afterMount() {
        // è°ƒç”¨åç«¯ API (core/api.js æä¾›çš„å°è£…)
        const res = await Api.get('/todo/list');
        // æ›´æ–°çŠ¶æ€ï¼Œè‡ªåŠ¨è§¦å‘ render
        this.setState({ list: res.data.items });
    }
}
```

### 5.2 æ³¨å†Œè·¯ç”±

åœ¨ `app.js` ä¸­æ³¨å†Œä½ çš„é¡µé¢ï¼š

```javascript
'/todo/list': { 
    auth: true, 
    handler: wrap(TodoPage, 'å¾…åŠäº‹é¡¹') 
}
```

---

## å…­ã€ä¸‰å¤§æˆ’å¾‹ (Don'ts)

| æˆ’å¾‹ | è¯´æ˜ | åæœ |
| :--- | :--- | :--- |
| ğŸ”´ **ä¸¥ç¦åç«¯æ¸²æŸ“ HTML** | åç«¯åªèƒ½è¿”å› JSONã€‚æ‰€æœ‰ UI å¿…é¡»åœ¨å‰ç«¯ JS ä¸­æ¸²æŸ“ã€‚ | ç ´åå‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ— æ³•é™æ€åŒ–éƒ¨ç½²ã€‚ |
| ğŸ”´ **ä¸¥ç¦è·¨æ¨¡å— Import** | æ¨¡å—ä¹‹é—´ç¦æ­¢ `from modules.blog import x`ã€‚ | å¯¼è‡´æ¨¡å—å¼ºè€¦åˆï¼Œæ— æ³•ç‹¬ç«‹çƒ­æ’æ‹”ã€‚è¯·ä½¿ç”¨ **äº‹ä»¶æ€»çº¿** é€šä¿¡ã€‚ |
| ğŸ”´ **ä¸¥ç¦ç§é€ å“åº”æ ¼å¼** | å¿…é¡»ä½¿ç”¨ `schemas.success()` ç­‰å·¥å…·å‡½æ•°ã€‚ | å¯¼è‡´å‰ç«¯ API è§£æå™¨æ— æ³•ç»Ÿä¸€å¤„ç†é”™è¯¯ã€‚ |
