[pytest]
# ------------------------------------------------------------------------------
# 基础测试配置
# ------------------------------------------------------------------------------
# 指定测试用例的搜索目录：tests(系统测试) 和 modules(模块测试)
testpaths = tests modules

# 指定测试文件的命名模式
python_files = test_*.py

# 指定测试类的命名模式
python_classes = Test*

# 指定测试函数的命名模式
python_functions = test_*

# ------------------------------------------------------------------------------
# 异步测试插件配置 (pytest-asyncio)
# ------------------------------------------------------------------------------
# 自动探测异步测试用例
asyncio_mode = auto

# 设置异步 fixture 的默认事件循环作用域为 session 级别
asyncio_default_fixture_loop_scope = session

# ------------------------------------------------------------------------------
# 输出与执行选项
# ------------------------------------------------------------------------------
# -v: 详细输出
# --tb=short: 简短的 traceback 格式，便于快速定位错误
# --strict-markers: 严格检查 markers，避免拼写错误
addopts = -v --tb=short --strict-markers

# ------------------------------------------------------------------------------
# 警告过滤器配置
# ------------------------------------------------------------------------------
filterwarnings =
    # 忽略 pytest 无法抛出的异常警告
    ignore::pytest.PytestUnraisableExceptionWarning
    # 忽略弃用警告
    ignore::DeprecationWarning
    # 忽略 jose.jwt 中的 datetime.utcnow() 弃用警告
    ignore:datetime.datetime.utcnow\(\) is deprecated:DeprecationWarning:jose.jwt
    # 忽略 Pydantic 模型配置冲突警告
    ignore:Field "model_name" has conflict with protected namespace "model_":UserWarning
    # 忽略 sentence_transformer 重构失败警告
    ignore:Could not reconstruct embedding function sentence_transformer:UserWarning

# ------------------------------------------------------------------------------
# 忽略的目录
# ------------------------------------------------------------------------------
# 忽略模板目录，避免运行模板测试
norecursedirs = modules/_template

# ------------------------------------------------------------------------------
# 自定义标记 (Markers)
# ------------------------------------------------------------------------------
markers =
    slow: 标记耗时较长的测试用例
    integration: 标记系统集成测试
    unit: 标记单元测试
