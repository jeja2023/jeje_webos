# 更新日志 (Changelog)

## v2.1.0 (2025-12-25) - 数据透镜架构升级与体验打磨

### 👁️ 数据透镜模块 (DataLens) 深度优化
- **Spotlight 联动**：支持通过 `Ctrl + K` 全局搜索功能快速发现并一键唤起数据视图窗口。
- **高性能文件缓存**：为 CSV 和 Excel 数据源引入 **DataFrame 内存缓存机制**（有效期 60s），彻底解决大文件分页查询时的 IO 瓶颈。
- **架构重构与解耦**：
  - **独立窗口显示**：点击视图卡片时，由“页内标签”改为“桌面独立窗口”模式。
  - **多开对比支持**：支持同时打开多个视图窗口，任务并行处理能力大幅提升。
  - **路由逻辑优化**：支持通过视图 URL 直接唤起独立窗口，实现了主 Hub 与子视图的完全解耦。

### 💄 UI/UX 与交互细节打磨
- **面包屑导航**：视图窗口新增 `数据透镜 > 分类 > 视图名` 面包屑，增强层级感知与专业感。
- **筛选逻辑优化**：隐藏筛选面板时不再清空已设定的条件，极大提升了复杂筛选场景下的连续操作体验。
- **预览按钮增强**：
  - 添加 `lens-btn-primary` 类，解决浅色模式下按钮不可见的问题。
  - 引入呼吸灯脉冲效果，强化执行指引。
- **样式变量统合**：
  - 修复了 DataLens 内部 CSS 变量命名不一致导致的背景显示异常，确保主题完美适配。
  - 增加了对 `--color-text` 和危险状态色的别名映射。

### 📖 文档更新
- **帮助中心**：新增「数据透镜指南」，详细说明新窗口架构和钉选功能。
- **README**：更新特性描述和版本号。

---

## v2.0.9 (2025-12-24) - 数据分析模块优化与测试规范

### 📊 数据分析模块增强
- **ETL 缓存持久化**：节点执行结果支持 Parquet 格式磁盘缓存，服务重启后可自动恢复，无需重新执行
- **BI 图表渲染优化**：
  - 顺序渲染：使用 `requestAnimationFrame` 避免同时渲染大量图表卡顿
  - 数据缓存：同一数据集多个组件共享缓存（30秒 TTL），减少重复 API 调用
  - 防抖 resize：全局共享 resize 监听器，避免内存泄漏
- **代码重构**：`aggregateData` 函数统一到 `Utils` 工具类，消除 `analysis_chart.js` 与 `analysis_bi.js` 中的重复实现

### 🧪 模块测试规范
- **测试目录结构**：测试文件放置在模块内部 `tests/` 目录下，模块删除时测试自动清理
- **单元测试覆盖**：为数据分析模块编写 26 个 ETL 算子单元测试，覆盖过滤、选择、去重、排序、聚合、采样、限制、类型转换、空值填充、重命名、清洗等算子

### 📖 开发规范更新
- **manifest.py 完整示例**：补充 `version`、`description`、`author`、`ModuleAssets`、`dependencies`、`kernel_version`、`enabled` 字段及生命周期钩子绑定
- **新增「4.4 模块测试规范」章节**：包含测试目录结构、代码示例、运行命令
- **模块内部结构表格更新**：添加 `tests/` 目录说明，`{id}_services.py` 说明复杂模块可拆分多个 service 文件
- **模块模板检查清单更新**：新增「生命周期钩子已绑定」和「tests/ 目录」检查项

### 🔧 模块热插拔修复
- **analysis 模块**：添加缺失的 `__init__.py` 文件
- **manifest 规范化**：更新 `analysis_manifest.py` 结构，与其他模块保持一致

---

## v2.0.8 (2025-12-20) - 数据分析与 BI 可视化增强

### 📊 图表分析功能
- **基础图表**：新增柱状图、饼图、折线图、散点图四种基础图表类型
- **高级图表**：
  - 📶 **直方图**：数据分布分析，自动分箱
  - 📦 **箱线图**：五数概括与异常值检测
  - 🔥 **热力图**：多字段相关性矩阵可视化（皮尔逊系数）
  - 🔮 **趋势预测**：基于移动平均的简单预测
- **图表引擎**：集成 ECharts 5.4.3，支持深色主题与响应式

### 🎯 BI 仪表盘模块
- **代码分离**：独立 `analysis_bi.js` 模块，便于维护扩展
- **仪表盘管理**：创建/删除/保存仪表盘，数据持久化至 LocalStorage
- **可视化组件**：支持柱状图、折线图、饼图、仪表盘等组件
- **编辑模式**：添加/删除/配置组件，支持多种尺寸（小/中/大/宽）
- **网格布局**：6列响应式网格系统，自动适配不同屏幕

### 🐛 主题样式修复
- **Dock 提示框**：修复深色主题下 tooltip 文字为黑色看不清的问题
- **按钮文字**：修复系统深色模式下按钮文字颜色未正确定义的问题

### 📁 新增文件
- `frontend/js/pages/analysis_bi.js` - BI 仪表盘组件
- `frontend/css/pages/analysis_bi.css` - BI 仪表盘样式

---

## v2.0.7 (2025-12-19) - 性能深度优化与品牌视觉提升
- 🚀 **后端全量 N+1 优化**：
    - **覆盖公告与反馈**：继笔记与博客后，全面修复公告 (Announcement) 与反馈 (Feedback) 模块的 N+1 查询问题。通过 ORM 显式联表加载 `selectinload`，确保获取列表和详情时，作者、处理人等关联信息一并加载，大幅降低数据库 IO。
- 📂 **存储结构优化**：
    - **统一备份目录**：将原本散落在 `backend/` 下的 `module_db_backups` 迁移至根目录 `storage/backups/modules`，实现了数据与代码的物理隔离，使后端目录更加纯净。
- 🎨 **品牌视觉识别增强**：
    - **全站图标同步**：在登录页与主页顶部栏引入 🌐 品牌图标，替换了临时的 Emoji。
    - **登录页 Logo**：支持自定义 Logo 图片展示，提升了系统的产品化质感。
- 🐛 **系统稳定性与兼容性**：
    - **Windows 环境适配**：修复了在 Windows 下通过应用市场上传模块包时，由于文件句柄未及时释放导致的“压缩包损坏”错误。
    - **冗余路由清理**：移除 `routers/health.py`，统一归并至 `core/health_checker.py`，减少维护成本。
- 🧪 **测试覆盖**：
    - 运行 `pytest` 通过全部 65 项后端单元测试，确保系统核心逻辑稳健。


## v2.0.6 (2025-12-18) - 系统性能优化与安全加固
- 🚀 **后端查询性能飞跃**：
    - **解决 N+1 问题**：重构笔记 (Notes) 与博客 (Blog) 模块的底层 ORM 模型关联，引入 `selectin` 预加载技术，将原本随列表规模线性增长的数据库请求压缩为常数级，列表加载速度平均提升 200%+。
    - **逻辑精简**：移除路由层冗余的循环异步查询，全面由 ORM 关系驱动数据填充。
- 🛡️ **底层安全加固**：
    - **Zip Slip 防御**：应用市场在安装 `.jwapp` 离线包时新增路径合法性校验，彻底封堵利用恶意相对路径进行系统文件篡改的漏洞。
- 🎨 **界面一致性与细节打磨**：
    - **视觉统合**：统一博客、公告管理页面的功能图标，将各类“新建/发布”操作图标统合为 `➕`，增强系统视觉连贯性。
    - **布局修复**：修复笔记页面在不同窗口尺寸下的弹性高度问题，确保侧边栏和主区域始终填满窗口且无溢出。
    - **浏览器兼容**：针对现代浏览器补全了 CSS 属性规范（如 `line-clamp`），消除检查警告并提升兼容性。
- 🧹 **代码质量改进**：
    - **冗余代码清理**：彻底移除已弃用的国际化 (i18n) API 及相关样式残留，保持代码库纯净。
    - **性能调优**：优化公共前端组件的加载逻辑，减少不必要的 DOM 重绘。

## v2.0.5 (2025-12-18) - 导航整合与笔记体验优化
- 🧭 **系统导航深度整合**：
    - **单一入口化**：侧边栏、开始菜单、Dock 菜单全面简化，不再显示繁琐的子菜单。
    - **一致性体验**：所有应用均通过主页面进入，子功能按键统一移至页面头部操作区，符合原生桌面操作逻辑。
    - **逻辑优化**：遵循 WebOS 窗口化逻辑，彻底移除所有应用子页面的返回按钮，界面更加清爽专业。
- 📝 **笔记模块 (Notes) 重构**：
    - **布局调整**：将“新建笔记”与“新建文件夹”按钮从侧边栏移至主视图头部右侧，保持与博客、公告等应用的一致性。
    - **导航优化**：侧边栏现在专注于目录树和快捷筛选（收藏、标签），布局更加整洁。
- 🏪 **应用中心 (App Center) 优化**：
    - **入口统一**：应用网格取消子菜单弹出，点击图标直接进入应用主页。
    - **路径修复**：补全了公告及其他动态模块的跳转路径映射，修复跳转失效问题。
- 🔧 **系统管理逻辑清晰化**：
    - 统一重命名“系统管理”相关入口，内部整合系统设置、日志、监控与备份，形成闭环管理体验。

## v2.0.4 (2025-12-18) - 控制面板与体验增强
- 🎛️ **用户管理控制面板**：
    - **快速创建用户**：管理员可直接添加用户，无需注册审核流程。
    - **重置用户密码**：管理员可一键重置任意用户密码。
    - **界面优化**：操作按钮统一调整，新增"添加用户"主操作按钮。
- 🔍 **全局搜索 (Spotlight)**：
    - **聚合搜索**：按下 `Ctrl + K` 或 `Ctrl + Space` 唤起搜索框，可同时搜索应用、系统设置项和云端文件。
    - **快速导航**：支持键盘光标键选择和回车打开，显著提升操作效率。
- 🔔 **通知中心增强**：
    - **通知持久化**：系统通知自动保存到消息中心供随时查阅。
    - **分类图标**：消息列表根据类型显示不同图标。
- 👤 **个人中心优化**：
    - **头像裁切**：上传头像前支持拖拽移动和缩放裁切，确保比例正确。
- 📱 **移动端适配**：
    - 新增全局样式 `mobile.css`，完善 TopBar、Dock 和桌面在小屏幕上的响应式布局。
- 🎨 **主题自动切换**：
    - 支持根据系统深色/浅色偏好自动切换主题。

## v2.0.3 (2025-12-18) - 应用市场功能完善
- 🏪 **应用市场**：
    - **离线安装**：支持通过 `.jwapp` 离线包上传安装第三方模块。
    - **规范化流程**：上传后模块处于"待安装"状态，需手动点击安装。
    - **创建应用**：支持一键创建新模块模板，自动生成前后端代码。
    - **删除应用**：支持完全删除未安装的模块。
- 🔧 **组件增强**：
    - **Toast.loading**：新增加载中提示组件，支持动态更新和手动关闭。

## v2.0.2 (2025-12-17) - 快传模块上线
- ⚡ **快传功能**：支持局域网内设备间高速文件传输，具备传输码机制与实时进度同步。
- 🎨 **界面优化**：全新设计的文件上传拖拽区域与传输历史列表。

## v2.0.1 (2025-12-16) - 文件管理与体验增强
- 📁 **文件管理增强**：新增右键菜单、拖拽移动、配额监控与增强的预览支持。
- 📝 **规范化**：统一系统各处功能名称，完善帮助中心文档。

## v2.0.0 (2025-12-15) - 统一发布版本
- ✨ **核心特性**：全新多窗口系统 (Multi-Window System)，支持窗口最小化、最大化、自由缩放与智能层级管理。
- 🎨 **体验优化**：Dock 栏指示器修复，浏览器地址栏同步功能。
